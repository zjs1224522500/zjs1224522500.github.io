<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    Elvis Zhang
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="Elvis">
<meta name="description" content="The easy way or the right way!">
<meta name="keywords" content="Dead">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://blog.shunzi.tech/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--点击特效-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/script/APlayer.min.js"></script>
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
                    
                        <!--CDN样式-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
                                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143818020-1"></script>
                                <script>
                                    window.dataLayer = window.dataLayer || [];

                                    function gtag() {
                                        dataLayer.push(arguments);
                                    }
                                    gtag('js', new Date());
                                    gtag('config', 'UA-143818020-1');
                                </script>
                                
                                    <script type="text/javascript">
                                        var _hmt = _hmt || [];
                                        (function() {
                                            var hm = document.createElement("script");
                                            hm.src = "https://hm.baidu.com/hm.js?225d600be3e5bb9ae41b903854555ba8";
                                            var s = document.getElementsByTagName("script")[0];
                                            s.parentNode.insertBefore(hm, s);
                                        })();
                                    </script>
                                    
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://blog.shunzi.tech">
                    Elvis Zhang
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/posts">
                        博客
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        归档
                    </a>
                    
                    <a class="menu-item" href="/tag/diary">
                        随笔
                    </a>
                    
                    <a class="menu-item" href="https://blog.shunzi.tech/post/tools">
                        导航
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        标签
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        关于
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1629902096628" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://blog.shunzi.tech">
                            Elvis Zhang
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1629902096628" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/posts">
                            博客
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            归档
                        </a>
                        
                        <a class="menu-item" href="/tag/diary">
                            随笔
                        </a>
                        
                        <a class="menu-item" href="https://blog.shunzi.tech/post/tools">
                            导航
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            标签
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            关于
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                GEM5 &amp; NVMain
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            Elvis Zhang
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2019-12-11</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">9.7
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">1577</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://blog.shunzi.tech/tag/PuY19cs53/">仿真</a>
                                
                                <a href="https://blog.shunzi.tech/tag/rIIc9E-ZvN/">系统结构</a>
                                
                            </span>
                                            
                                                阅读量:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                            <img class="post-feature-image" src="https://blog.shunzi.tech/post-images/gem5-and-nvmain.png" alt="">
                          
                        <div class="post-content">
                            <blockquote>
<ul>
<li>该篇主要记录 gem5 的安装和简单使用过程</li>
<li>计算机系统设计课程实验环境需要，部分论文的实验仿真环境为 gem5</li>
<li>结合部分 Paper，简要介绍 gem5 主要模拟的场景和测试方法</li>
</ul>
</blockquote>
<!--more-->
<h2 id="gem5">gem5</h2>
<h3 id="what-is-gem5">What is gem5?</h3>
<ul>
<li>A modular platform for computer-system architecture research</li>
</ul>
<h4 id="about">About</h4>
<ul>
<li>The gem5 simulator is a modular platform for computer-system architecture research, encompassing system-level architecture as well as processor microarchitecture.</li>
</ul>
<h3 id="install-and-test">Install And Test</h3>
<h4 id="install-dependencies-firstly">Install dependencies firstly</h4>
<ul>
<li><code>sudo apt-get install mercurial scons swig gcc m4 python python-dev libgoogle-perftools-dev g++ libprotobuf-dev</code></li>
<li><code>sudo apt-get install build-essential</code></li>
<li><strong>Notice</strong>：<strong><code>apt get</code></strong> is for <strong>Ubuntu</strong></li>
</ul>
<h4 id="download-the-source-code">Download the source code</h4>
<ul>
<li><code>hg clone http://repo.gem5.org/gem5</code></li>
<li><code>git clone https://gem5.googlesource.com/public/gem5</code></li>
<li><code>git clone git@github.com:gem5/gem5.git</code></li>
<li><a href="https://github.com/gem5/gem5">github repo(read only)</a></li>
</ul>
<h4 id="build-the-source-code">Build the source code</h4>
<ul>
<li><code>cd {gem5-source-code-dir}</code></li>
<li><code>scons build/X86/gem5.opt</code></li>
</ul>
<h4 id="simple-test">Simple Test</h4>
<ul>
<li><code>cd {gem5-source-code-dir}</code></li>
<li>Check and edit the hello.c：<code>vim tests/test-progs/hello/src/hello.c</code></li>
<li>Run the hello.c：<code>build/X86/gem5.opt configs/example/se.py -c tests/test-progs/hello/bin/x86/linux/hello</code></li>
<li>Check the result if contains &quot;<strong>Hello world!</strong>&quot;</li>
</ul>
<h4 id="check-the-output">Check the output</h4>
<ul>
<li><code>cd m5out/</code></li>
<li><code>ls</code></li>
<li><code>config.ini</code> and <code>config.json</code> describe the configuration info of the simulator.</li>
<li><code>stats.txt</code> describes the info of this test.</li>
<li><strong>Notice</strong>：This is in <strong>SE - System-call Emulation</strong> mode (which is designed for running the test program separately). The other mode <strong>FS - Full System</strong> mode is designed for running the whole linux os.</li>
</ul>
<h3 id="use">Use</h3>
<ul>
<li><strong>Run</strong>：<code>&lt;gem5 binary&gt; [gem5 options] &lt;simulation script&gt; [script options]</code></li>
</ul>
<h4 id="se-mode">SE mode</h4>
<h5 id="prepare">Prepare</h5>
<ul>
<li>Edit the source code and save： <code>vim Test.c</code></li>
</ul>
<pre><code class="language-C">#include&lt;stdio.h&gt;
int main()
{
    printf(&quot;Hello Test!\n&quot;);
    return 0;
}
</code></pre>
<ul>
<li>Build：<code>gcc -o {Output-File-Name} {Source-File-Name} -static</code></li>
<li>Test：<code>./{Output-File-Name}</code></li>
<li><code>gcc -o Test Test.c -static</code></li>
<li><code>./Test</code></li>
<li><strong>Notice</strong>：If gcc return error info : /usr/bin/ld: cannot find -lc, try to install <code>sudo yum install glibc-static</code></li>
</ul>
<h5 id="build-and-run">Build and Run</h5>
<ul>
<li>Enter gem5 directory</li>
<li>Build the arch if never build ：<code>scons build/X86/gem5.opt</code></li>
<li>Run the code：<code>build/X86/gem5.opt configs/example/se.py -c {Output-File-Name}</code></li>
<li><code>build/X86/gem5.opt configs/example/se.py -c /shunzi-test/Test</code></li>
<li>Check the result if contains &quot;Hello Test!&quot;.</li>
</ul>
<h5 id="notice">Notice</h5>
<ul>
<li>In order to pass command line arguments to a binary you can use <code>--options=&quot;arg1 arg2 ...&quot;</code> to specify them as a script option in your simulation command.</li>
<li><strong>SE</strong> mode : Static Compile &amp; Single Thread</li>
</ul>
<h4 id="fs-mode">FS mode</h4>
<ul>
<li>Use x86 Arch as an example.</li>
</ul>
<h5 id="prepare-2">Prepare</h5>
<ul>
<li>Download and install the full-system binary and disk image files.</li>
<li>For Alpha full system files：<code>wget http://www.m5sim.org/dist/current/m5_system_2.0b3.tar.bz2</code>. (We will use one file in this tar in next step.)</li>
<li>For x86 full system files：<code>wget http://www.m5sim.org/dist/current/x86/x86-system.tar.bz2</code></li>
<li>Create fs-image directory and unzip the x86 system files to here：<code>tar -xjf /shunzi-test/m5/system/x86-system.tar.bz2</code></li>
<li>Create new directory such as <code>alpha</code> to store the data unziped from Alpha full system files：<code>tar -xjf /shunzi-test/m5/system/m5_system_2.0b3.tar.bz2</code></li>
<li>Copy the file <code>linux-bigswap2.img</code> in Alpha full system files to <code>../fs-image/disk</code> directory： <code>cp linux-bigswap2.img /shunzi-test/gem5-master/fs-image/</code></li>
<li>Change the environment varibles in file <code>.bashrc</code>.And add path <code>export M5_PATH=$M5_PATH:/shunzi-test/gem5-master/fs-image/</code>. Make the change work：<code>source .bashrc</code>.</li>
</ul>
<h5 id="run">Run</h5>
<ul>
<li>In gem5 directory, run the py program：<code>build/X86/gem5.opt configs/example/fs.py</code>. And it may throw exceptions and errors.You can viee details in <strong>Notice</strong> part as first two tips.</li>
<li>Rerun with command given kernel and disk image as params：<code>build/X86/gem5.opt configs/example/fs.py --kernel=x86_64-vmlinux-2.6.22.9 --disk-image=linux-x86.img</code>.And check the output if contains following msgs:</li>
</ul>
<pre><code class="language-Shell">gem5 Simulator System.  http://gem5.org
gem5 is copyrighted software; use the --copyright option for details.

gem5 compiled Nov 11 2019 18:23:53
gem5 started Nov 14 2019 15:31:57
gem5 executing on ceph-node1.localdomain, pid 729112
command line: build/X86/gem5.opt configs/example/fs.py --kernel=x86_64-vmlinux-2.6.22.9 --disk-image=linux-x86.img

Global frequency set at 1000000000000 ticks per second
warn: DRAM device capacity (8192 Mbytes) does not match the address range assigned (512 Mbytes)
info: kernel located at: /shunzi-test/gem5-master/fs-image/binaries/x86_64-vmlinux-2.6.22.9
system.pc.com_1.device: Listening for connections on port 3456
      0: system.pc.south_bridge.cmos.rtc: Real-time clock set to Sun Jan  1 00:00:00 2012
0: system.remote_gdb: listening for remote gdb on port 7000
warn: Reading current count from inactive timer.
**** REAL SIMULATION ****
info: Entering event queue @ 0.  Starting simulation...
warn: Don't know what interrupt to clear for console.
warn: x86 cpuid: unknown family 0x8086
</code></pre>
<ul>
<li>Mount the image file to /mnt：<code>mount -o,loop,offset=32256 /shunzi-test/m5/system/linux-x86.img /mnt</code></li>
<li>Mount the example code：<code>cp tests/test-progs/hello/bin/x86/linux/hello /mnt</code>or mount code wrote by yourself. <code>cp Test /mnt</code></li>
<li>Umount the mnt：<code>umount /mnt</code></li>
<li>Rerun the gem5 with FS mode：<code>build/X86/gem5.opt configs/example/fs.py --kernel=x86_64-vmlinux-2.6.22.9 --disk-image=linux-x86.img</code></li>
<li>In another session, run the /util/term/m5term：<code>m5term 127.0.0.1 3456</code></li>
</ul>
<h5 id="notice-2">Notice</h5>
<ul>
<li>Change path in SysPaths.py ：<code>vim ./configs/common/SysPaths.py</code>. And adjust the code.</li>
</ul>
<pre><code class="language-Python">// Old Version
except KeyError:
    path = [ '/dist/m5/system', '/n/poolfs/z/dist/m5/system' ]

// New Version
except KeyError:
    path = [ '/dist/m5/system', '/shunzi-test/gem5-master/fs-image' ]
</code></pre>
<ul>
<li>Change the x86 image name in Benchmarks.py：<code>vim configs/common/Benchmarks.py</code></li>
</ul>
<pre><code class="language-Python">// Old Version
elif buildEnv['TARGET_ISA'] == 'x86':
    return env.get('LINUX_IMAGE', disk('x86root.img'))

// New Version
elif buildEnv['TARGET_ISA'] == 'x86':
    return env.get('LINUX_IMAGE', disk('linux-x86.img'))
</code></pre>
<ul>
<li>If you run the code written by yourself, please confirm the version of gcc between the image and the compiled version. Otherwise, you will have to face the problem of too old kenerl version.</li>
</ul>
<h2 id="nvmain">NVMain</h2>
<h3 id="install-and-build">Install And Build</h3>
<h4 id="download-source">Download Source</h4>
<ul>
<li><code>hg clone https://bitbucket.org/mrp5060/nvmain</code></li>
<li>or <code>wget https://bitbucket.org/mrp5060/nvmain/get/9c0e87b164bc.zip</code></li>
<li>or download to local system and upload (recommand)</li>
<li>or download from github https://github.com/cyjseagull/gem5-nvmain-hybrid-simulator.</li>
</ul>
<h4 id="build">Build</h4>
<ul>
<li><code>scons –build-type=fast</code> may throw error messages.</li>
<li>If success, the file <code>nvmain.fast</code> will be generated in the nvmain directory.</li>
</ul>
<h3 id="use-2">Use</h3>
<h4 id="test">Test</h4>
<ul>
<li>Use inner test program and test data to test：<code>./nvmain.fast Config/PCM_ISSCC_2012_4GB.config Tests/Traces/hello_world.nvt 10000000</code></li>
</ul>
<h4 id="datatype-check">DataType Check</h4>
<h5 id="define-4-types">Define 4 types</h5>
<ul>
<li>write-unit 8 bytes：00000000，0000XXXX，00XX00XX，OtherType</li>
</ul>
<h5 id="implementation">Implementation</h5>
<ul>
<li>Define four counter in nvmain.h.</li>
</ul>
<pre><code class="language-C++">    ncounter_t total00000000;
    ncounter_t total0000xxxx;
    ncounter_t total00xx00xx;
    ncounter_t totalOtherType;
</code></pre>
<ul>
<li>Init the counter in constructor.</li>
</ul>
<pre><code class="language-C++">    total00000000 = 0;
    total0000xxxx = 0;
    total00xx00xx = 0;
    totalOtherType = 0;
</code></pre>
<ul>
<li>Count the amount of different data type.</li>
</ul>
<pre><code class="language-C++">{
     totalWriteRequests++;
     NVMDataBlock recvData;
     recvData = request-&gt;data;
     recvData.SetSize(64);
     int index = 0;
     uint8_t newByte;
     for (index = 0; index &lt; 64; index+=8) {
         //uint8_t byteOne, byteTwo, byteThree, byteFour, byteFive, byteSix, byteEight;
         uint8_t byteData[8] = {1,1,1,1,1,1,1,1};
         for (int i = 0; i &lt; 8; i++) {
             newByte = recvData.GetByte(index + i);
             if (!(newByte &amp; 0xff)) {
                 byteData[i] = 0;
             }
         }
         if (!(byteData[0] | byteData[1] | byteData[2] | byteData[3] | byteData[4]
               | byteData[5] | byteData[6] | byteData[7])) {
             total00000000++;
         } else if (!(byteData[0] | byteData[1] | byteData[2] | byteData[3])) {
             total0000xxxx++;
         } else if (!(byteData[0] | byteData[1] | byteData[4] | byteData[5])) {
             total00xx00xx++;
         } else {
             totalOtherType++;
         }
     }
}
</code></pre>
<ul>
<li>Print the result</li>
</ul>
<pre><code class="language-C++">void NVMain::RegisterStats( )
{
    AddStat(totalReadRequests);
    AddStat(totalWriteRequests);
    AddStat(successfulPrefetches);
    AddStat(unsuccessfulPrefetches);

    AddStat(total00000000);
    AddStat(total0000xxxx);
    AddStat(total00xx00xx);
    AddStat(totalOtherType);
    AddStat(totalWriteBytes);
    AddStat(totalCompressWriteBytes);
}

</code></pre>
<h2 id="gem5-nvmain">Gem5 &amp; NVMain</h2>
<h3 id="build-2">Build</h3>
<ul>
<li>Build Alpha Arch：<code>scons EXTRAS=/shunzi-test/nvmain/gem5-nvmain-hybrid-simulator/nvmain-gem5/nvmain ./build/ALPHA/gem5.opt -j8</code></li>
</ul>
<h3 id="test-2">Test</h3>
<ul>
<li>Run hello-world：<code>./build/ALPHA/gem5.opt configs/example/se.py -c tests/test-progs/hello/bin/alpha/linux/hello --cpu-type=detailed --caches --l2cache --mem-type=NVMainMemory --nvmain-config=../nvmain/Config/PCM_ISSCC_2012_4GB.config</code></li>
</ul>
<h3 id="parsec21">Parsec2.1</h3>
<h4 id="download-neccessary-dependencies">Download neccessary dependencies</h4>
<ul>
<li><code>wget http://www.cs.utexas.edu/~parsec_m5/vmlinux_2.6.27-gcc_4.3.4</code></li>
<li><code>wget http://www.cs.utexas.edu/~parsec_m5/tsb_osfpal</code></li>
<li><code>wget http://www.cs.utexas.edu/~parsec_m5/linux-parsec-2-1-m5-with-test-inputs.img.bz2</code></li>
<li><code>wget http://www.cs.utexas.edu/~parsec_m5/linux-parsec-2-1-m5-with-test-inputs.img.bz2</code></li>
</ul>
<h4 id="use-parsec21">Use Parsec2.1</h4>
<ul>
<li>Use util to generate shell：<code>./writescripts.pl blackscholes 4</code></li>
<li>Rebuild the gem5：<code>scons build/ALPHA/gem5.opt -j8</code></li>
<li>Run with blackscholes_4c_simmedium.rcS Script without nvmain：<code>./build/ALPHA/gem5.opt ./configs/example/fs.py -n 2 --script=/shunzi-test/nvmain/gem5-nvmain-hybrid-simulator/nvmain-gem5/gem5/TR-09-32-parsec-2.1-alpha-files/blackscholes_4c_simmedium.rcS -F 5000000000</code></li>
<li>Run with nvmain：<code>./build/ALPHA/gem5.opt ./configs/example/fs.py -n 2 --script=/shunzi-test/nvmain/gem5-nvmain-hybrid-simulator/nvmain-gem5/gem5/TR-09-32-parsec-2.1-alpha-files/blackscholes_4c_simsmall.rcS --mem-type=NVMainMemory --nvmain-config=../nvmain/Config/PCM_ISSCC_2012_4GB.config -F 500000000</code></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="http://www.m5sim.org/Main_Page">[1] gem5 official page</a></li>
<li><a href="https://blog.csdn.net/u012822903/article/details/62227021">[2] CSDN：Gem5的FS（全系统）模拟</a></li>
</ul>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#gem5">gem5</a>
<ul>
<li><a href="#what-is-gem5">What is gem5?</a>
<ul>
<li><a href="#about">About</a></li>
</ul>
</li>
<li><a href="#install-and-test">Install And Test</a>
<ul>
<li><a href="#install-dependencies-firstly">Install dependencies firstly</a></li>
<li><a href="#download-the-source-code">Download the source code</a></li>
<li><a href="#build-the-source-code">Build the source code</a></li>
<li><a href="#simple-test">Simple Test</a></li>
<li><a href="#check-the-output">Check the output</a></li>
</ul>
</li>
<li><a href="#use">Use</a>
<ul>
<li><a href="#se-mode">SE mode</a>
<ul>
<li><a href="#prepare">Prepare</a></li>
<li><a href="#build-and-run">Build and Run</a></li>
<li><a href="#notice">Notice</a></li>
</ul>
</li>
<li><a href="#fs-mode">FS mode</a>
<ul>
<li><a href="#prepare-2">Prepare</a></li>
<li><a href="#run">Run</a></li>
<li><a href="#notice-2">Notice</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#nvmain">NVMain</a>
<ul>
<li><a href="#install-and-build">Install And Build</a>
<ul>
<li><a href="#download-source">Download Source</a></li>
<li><a href="#build">Build</a></li>
</ul>
</li>
<li><a href="#use-2">Use</a>
<ul>
<li><a href="#test">Test</a></li>
<li><a href="#datatype-check">DataType Check</a>
<ul>
<li><a href="#define-4-types">Define 4 types</a></li>
<li><a href="#implementation">Implementation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#gem5-nvmain">Gem5 &amp; NVMain</a>
<ul>
<li><a href="#build-2">Build</a></li>
<li><a href="#test-2">Test</a></li>
<li><a href="#parsec21">Parsec2.1</a>
<ul>
<li><a href="#download-neccessary-dependencies">Download neccessary dependencies</a></li>
<li><a href="#use-parsec21">Use Parsec2.1</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>Elvis Zhang</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://blog.shunzi.tech/post/gem5-and-nvmain/">https://blog.shunzi.tech/post/gem5-and-nvmain/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR 码" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://blog.shunzi.tech/post/gem5-and-nvmain/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.shunzi.tech/post/gem5-and-nvmain/&sharesource=qzone&title=GEM5 &amp; NVMain&pics=https://blog.shunzi.tech/images/avatar.png?v=1629902096628&summary=&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;该篇主要记录 gem5 的安装和简单使用过程&lt;/li&gt;
&lt;li&gt;计算机系统设计课程实验环境需要，部分论文的实验仿真环境为 gem5&lt;/li&gt;
&lt;li&gt;结合部分 Paper，简要介绍 gem5 主要模拟的场景和测试方法&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
"><i class="fa fa-qq"></i></a>
                                                                    <a title="新浪微博" target="_blank" href="https://service.weibo.com/share/share.php?url=https://blog.shunzi.tech/post/gem5-and-nvmain/&sharesource=weibo&title=GEM5 &amp; NVMain + " - " + &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;该篇主要记录 gem5 的安装和简单使用过程&lt;/li&gt;
&lt;li&gt;计算机系统设计课程实验环境需要，部分论文的实验仿真环境为 gem5&lt;/li&gt;
&lt;li&gt;结合部分 Paper，简要介绍 gem5 主要模拟的场景和测试方法&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&pic="https://blog.shunzi.tech/images/avatar.png?v=1629902096628 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://blog.shunzi.tech/tag/PuY19cs53/">#
                    仿真
                        </a>
                        
                        <a href="https://blog.shunzi.tech/tag/rIIc9E-ZvN/">#
                    系统结构
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://blog.shunzi.tech/post/rbc-based-on-rdma/">
                                                                                            基于RDMA的RPC实现
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://blog.shunzi.tech/post/ceph-tiring-cache-optimization/">
                                                                                                    Ceph Tiring Cache 调优
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                <div class="post-wrap">
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: 'Pj5H1z0w7hJlLGJpGBh9NrCq-MdYXbMMI',
        appKey: 'LdR8vK5EaBfK87esF7tlbsXe',
        pageSize: 5,
        avatar: 'mp',
        placeholder: '来都来了，不妨评论一下',
        visitor: false,
        highlight: false,
        recordIP: false,
    })
</script>
                                                    
                                                </div>
            </div>
    </div>
    </div>
    </div>
    
    <div id="player"></div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        Elvis Zhang &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://github.com/" target="_blank">
                                                Github Pages
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.6
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    

                    function LoadPlayer() {
                        var musicList = [];
                        
                        musicList.push({
                            name: 'See You Again (feat. Charlie Puth)',
                            url: 'https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBbmlqSWg1RWM0TlZoSXhtUU9nLTk3R2g5cDVlblE.mp3',
                            artist: 'Charlie Puth',
                            cover: 'https://4.bp.blogspot.com/-tk-Dzg0cHNQ/WnxPiEImF8I/AAAAAAAAMbg/FisRjWssG3kMFGiMh1BE3j4U6QnI2O3rwCLcBGAs/s1600/wiz-khalifa-see-you-again.jpg',
                        });
                        
                        console.log(" MusicList: " + musicList);
                        
                        const ap = new APlayer({
                            container: document.getElementById('player'),
                            fixed: true,
                            audio: musicList
                        });
                        
                    }
                    LoadPlayer();
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1629902096628);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>