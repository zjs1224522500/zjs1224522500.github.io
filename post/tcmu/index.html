<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TCMUå­¦ä¹ ç¬”è®° | Elvis Zhang</title>
<meta name="description" content="The easy way or the right way." />
<link rel="shortcut icon" href="https://blog.shunzi.tech/favicon.ico">
<link rel="stylesheet" href="https://blog.shunzi.tech/styles/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

<script data-ad-client="ca-pub-7661668224317940" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script src="https://blog.shunzi.tech/media/js/jquery.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/masonry.pkgd.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/aos.js"></script>
<script src="https://blog.shunzi.tech/media/js/pace.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/view-image.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="

iSCSI Target ç«¯çš„ç”¨æˆ·æ€å®ç° TCMU ä»‹ç»
TCMU åŸç†å‰–æ
TCMU å¯¹æ¥è‡ªå®šä¹‰åç«¯å­˜å‚¨ä»£ç ç¤ºä¾‹è®²è§£








TCMU ç®€ä»‹
TCMU ä¼˜åŠ¿
è®¾è®¡çº¦æŸ
å®ç°æ¦‚è§ˆ

MailBox
Command Ring

T..." />
    <meta name="keywords" content="å­˜å‚¨,Linux" />
    <script src="https://blog.shunzi.tech/media/js/waterfall.min.js"></script>
    <script src="https://blog.shunzi.tech/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://blog.shunzi.tech"><img src="\media\images\custom-headerLogo.jpg" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://blog.shunzi.tech" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tag/diary" class="menu">
                      éšç¬”
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/movies" class="menu">
                      è§‚å½±
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/post/about" class="menu">
                      å…³äº
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1610809361880" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://github.com/zjs1224522500/files-and-images/blob/master/blog/pic/TCMU-LIO.png?raw=true');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2019-07-17"><i class="fa fa-calendar"></i><span class="lately">1 å¹´å‰</span></time>
              
              <a href="https://blog.shunzi.tech/post/tcmu/#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/tcmu/"> </span>
              </a>
              <span id="/tcmu/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://blog.shunzi.tech/tag/3zCwFWPHxH/" class="ctag ctag-0 ctag-3zCwFWPHxH" aria-label="">å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/EO3XpMf_y/" class="ctag ctag-1 ctag-EO3XpMf_y" aria-label="">Linux</a>
                    
              </div>
              <h1 class="title ularge white bold">TCMUå­¦ä¹ ç¬”è®°</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <blockquote>
<ul>
<li>iSCSI Target ç«¯çš„ç”¨æˆ·æ€å®ç° TCMU ä»‹ç»</li>
<li>TCMU åŸç†å‰–æ</li>
<li>TCMU å¯¹æ¥è‡ªå®šä¹‰åç«¯å­˜å‚¨ä»£ç ç¤ºä¾‹è®²è§£</li>
</ul>
</blockquote>
<!-- more -->
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#tcmu-%E7%AE%80%E4%BB%8B">TCMU ç®€ä»‹</a></li>
<li><a href="#tcmu-%E4%BC%98%E5%8A%BF">TCMU ä¼˜åŠ¿</a></li>
<li><a href="#%E8%AE%BE%E8%AE%A1%E7%BA%A6%E6%9D%9F">è®¾è®¡çº¦æŸ</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%A6%82%E8%A7%88">å®ç°æ¦‚è§ˆ</a>
<ul>
<li><a href="#mailbox">MailBox</a></li>
<li><a href="#command-ring">Command Ring</a>
<ul>
<li><a href="#tcmu_op_cmd">TCMU_OP_CMD</a></li>
<li><a href="#tcmu_op_pad">TCMU_OP_PAD</a></li>
</ul>
</li>
<li><a href="#data-area">Data Area</a></li>
</ul>
</li>
<li><a href="#tcmu-%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD">TCMU åŠ¨æ€é…ç½®åŠ è½½</a></li>
<li><a href="#tcmu-plugin-handler">TCMU Plugin Handler</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%B8%80-%E5%85%A8%E6%9D%83%E6%8E%A5%E7%AE%A1%E5%91%BD%E4%BB%A4%E5%A4%84%E7%90%86">å®ç°æ–¹å¼ä¸€  å…¨æƒæ¥ç®¡å‘½ä»¤å¤„ç†</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%BA%8C-%E4%BB%85%E5%AE%9E%E7%8E%B0%E5%85%B7%E4%BD%93%E7%9A%84io%E6%93%8D%E4%BD%9C">å®ç°æ–¹å¼äºŒ  ä»…å®ç°å…·ä½“çš„IOæ“ä½œ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h3 id="tcmu-ç®€ä»‹">TCMU ç®€ä»‹</h3>
<ul>
<li>TCM æ˜¯ LIO çš„åˆ«åï¼Œæ˜¯å†…æ ¸æ€çš„ scsi target å®ç°ã€‚TCM targets è¿è¡Œåœ¨å†…æ ¸æ€ï¼ŒTCMUï¼ˆTCM in Userspaceï¼‰æ˜¯ LIO çš„ç”¨æˆ·æ€å®ç°ã€‚</li>
<li>ç°æœ‰çš„å†…æ ¸ä¸ºä¸åŒçš„SCSIä¼ è¾“åè®®æä¾›äº†æ¨¡å—ã€‚TCM ä¹Ÿæ¨¡å—åŒ–æ•°æ®å­˜å‚¨ï¼Œç›®å‰å·²ç»æ”¯æŒæ–‡ä»¶(fileio)ï¼Œå—è®¾å¤‡(block)ï¼ŒRAMDISK æˆ–å…¶ä»–iSCSIè®¾å¤‡ï¼ˆpscsiï¼‰ï¼Œè¿™äº›ç§°ä¸º backstore æˆ– storage engineã€‚è¿™äº›å†…å»ºçš„æ¨¡å—å®Œå…¨åœ¨å†…æ ¸æ€å®ç°ã€‚</li>
<li>LIO ä»…èƒ½ä½¿ç”¨å†…æ ¸æ€çš„ backstoreã€‚è€Œå¦‚ tgt è¿™æ ·çš„å…¶ä»–çš„ç”¨æˆ·æ€ target è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿæ”¯æŒ Gluster çš„ GLFS å’Œ Ceph çš„ RBD ä½œä¸º backstoreã€‚target ç›¸å½“äº translatorï¼Œå…è®¸ initiators é€šè¿‡æ ‡å‡†åè®®å­˜å‚¨æ•°æ®åˆ°è¿™äº›éä¼ ç»Ÿçš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿã€‚</li>
<li>ä¸º LIO å¢åŠ è¿™äº›æ”¯æŒå­˜åœ¨æ›´å¤šçš„å›°éš¾ï¼Œå› ä¸º LIO æ˜¯çº¯å†…æ ¸æ€ä»£ç ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯å°† GLFS å’Œ RBD API å’Œ protocols åº“ç§»æ¤åˆ°å†…æ ¸ï¼Œå¦ä¸€ç§æ–¹æ¡ˆæ˜¯ä¸º LIO åˆ›å»ºç”¨æˆ·ç©ºé—´ pass-through backstoreï¼Œç§°ä¸º TCMUã€‚å‰è€…çš„å·¥ä½œè¿œæ¯”åè€…å¤æ‚ã€‚</li>
</ul>
<h3 id="tcmu-ä¼˜åŠ¿">TCMU ä¼˜åŠ¿</h3>
<ul>
<li>é™¤äº†å¯ä»¥å®¹æ˜“æ”¯æŒ RBD å’Œ GLFSï¼ŒTCMU å°†å…è®¸æ›´åŠ ç®€å•çš„æ–¹å¼æ¥å¼€å‘æ–°çš„ backstoreã€‚TCMU ä¸ LIO loopback ç»„åˆï¼Œå®ç°ç±»ä¼¼äº FUSE(File system in Userspace) çš„æœºåˆ¶ï¼Œåªæ˜¯ SCSI layer æ›¿æ¢äº† file system layerã€‚</li>
<li>è¿™ç§æœºåˆ¶çš„åŠ£åŠ¿æ˜¯éœ€è¦é…ç½®æ›´å¤šä¸åŒçš„ç»„ä»¶ï¼Œå­˜åœ¨æ•…éšœçš„é£é™©ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å·¥ä½œé‡å°½å¯èƒ½å°‘çš„è¯ï¼Œè¿™äº›ä¸å¯é¿å…ï¼Œåªèƒ½å¸Œæœ›æ•…éšœä¸æ˜¯è‡´å‘½çš„å½±å“ã€‚</li>
</ul>
<h3 id="è®¾è®¡çº¦æŸ">è®¾è®¡çº¦æŸ</h3>
<ul>
<li>é«˜æ€§èƒ½ï¼š é«˜ååé‡ï¼Œä½å»¶è¿Ÿã€‚</li>
<li>ç®€æ´å¤„ç†ï¼Œå¦‚æœç”¨æˆ·ç©ºé—´å‘ç”Ÿå¦‚ä¸‹æ•…éšœï¼š
<ul>
<li>1ï¼‰ nerver attaches</li>
<li>2ï¼‰ hangs</li>
<li>3ï¼‰ dies</li>
<li>4ï¼‰ misbehaves</li>
</ul>
</li>
<li>å…è®¸æœªæ¥åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„çµæ´»å®ç°ã€‚</li>
<li>åˆç†çš„å†…å­˜ä½¿ç”¨ã€‚</li>
<li>ç®€å•åœ°é…ç½®å’Œè¿è¡Œã€‚</li>
<li>ç®€å•åœ°ç¼–å†™ç”¨æˆ·ç©ºé—´ backendã€‚<br>
<img src="https://github.com/zjs1224522500/files-and-images/blob/master/blog/pic/TCMU-LIO.png?raw=true" alt="image" loading="lazy"></li>
</ul>
<h3 id="å®ç°æ¦‚è§ˆ">å®ç°æ¦‚è§ˆ</h3>
<ul>
<li>TCMU æ¥å£çš„æ ¸å¿ƒæ˜¯ä¸€æ®µç”±ç”¨æˆ·æ€å’Œå†…æ ¸æ€å…±äº«çš„å†…å­˜åŒºåŸŸã€‚è¿™å—åŒºåŸŸåŒ…æ‹¬ï¼š
<ul>
<li>
<ol>
<li>æ§åˆ¶åŒºåŸŸï¼ˆmailboxï¼‰ï¼›</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ— é”çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…ç¯å½¢bufferï¼Œç”¨äºå‘½ä»¤çš„ä¼ é€’å’ŒçŠ¶æ€çš„è¿”å›ï¼›</li>
</ol>
</li>
<li>
<ol start="3">
<li>æ•°æ®in/outçš„ç¼“å†²åŒºã€‚</li>
</ol>
</li>
</ul>
</li>
<li>TCMU ä½¿ç”¨äº†å·²ç»å­˜åœ¨çš„ UIO å­ç³»ç»Ÿã€‚ UIO å­ç³»ç»Ÿå…è®¸è®¾å¤‡é©±åŠ¨åœ¨ç”¨æˆ·æ€å¼€å‘ï¼Œè¿™ä¸ªæ¦‚å¿µååˆ†è´´è¿‘ TCMU çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œé™¤äº†ç‰©ç†è®¾å¤‡ï¼Œ TCMU ä¸º SCSI å‘½ä»¤å®ç°äº†å†…å­˜æ˜ å°„å±‚ã€‚ä½¿ç”¨ UIO ä¹Ÿæœ‰åˆ©äº TCMU å¤„ç†è®¾å¤‡çš„è‡ªçœï¼Œå¦‚é€šè¿‡ç”¨æˆ·æ€å»å†³å®šä½¿ç”¨å¤šå¤§çš„å…±äº«åŒºåŸŸï¼Œå’Œä¸¤ç«¯çš„ä¿¡å·æœºåˆ¶ã€‚</li>
<li>å†…å­˜åŒºåŸŸæ˜¯æ²¡æœ‰æŒ‡é’ˆçš„ï¼Œåªæœ‰ç›¸å¯¹äºå†…å­˜åŒºåŸŸèµ·å§‹ä½ç½®çš„ offsetã€‚é€šè¿‡è¿™ç§æœºåˆ¶å¯ä»¥ä½¿åœ¨ç”¨æˆ·è¿›ç¨‹æŒ‚æ‰æˆ–è€…é‡å¯ä½¿å¾—å†…å­˜åŒºåŸŸåœ¨ä¸åŒçš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„æƒ…å†µä¸‹ï¼Œä»ç„¶ä¿æŒå·¥ä½œã€‚å¯ä»¥æŸ¥çœ‹<code>target_core_user.h</code>æŸ¥çœ‹ç»“æ„çš„å®šä¹‰ã€‚</li>
</ul>
<h4 id="mailbox">MailBox</h4>
<ul>
<li>mailboxæ€»æ˜¯åœ¨å…±äº«å†…å­˜çš„å¼€å§‹ä½ç½®ï¼Œå¹¶ä¸”åŒ…å«äº†versionï¼Œå¼€å§‹ä½ç½®çš„offsetï¼Œcommand ringçš„å¤§å°ï¼Œç”¨æˆ·æ€å’Œå†…æ ¸æ€å­˜æ”¾ring commandå’Œcommandå®ŒæˆçŠ¶æ€çš„headå’ŒtailæŒ‡é’ˆã€‚</li>
</ul>
<pre><code class="language-C">struct tcmu_mailbox {
	__u16 version; // 2 å¦‚æœæ˜¯åˆ«çš„å€¼ï¼Œç”¨æˆ·ç©ºé—´åº”è¯¥åºŸå¼ƒï¼‰
	__u16 flags; //TCMU_MAILBOX_FLAG_CAP_OOOC: æ ‡å¿—æ”¯æŒout-of-order completion
	__u32 cmdr_off; //command ringåœ¨å†…å­˜åŒºåŸŸçš„èµ·å§‹ä½ç½®çš„åç§»é‡ã€‚
	__u32 cmdr_size; //command ringåŒºåŸŸçš„å¤§å°ã€‚è¿™ä¸éœ€è¦2çš„å¹‚æ¥è¡¨ç¤ºã€‚

	__u32 cmd_head; //ç”±å†…æ ¸ä¿®æ”¹ï¼Œè¡¨ç¤ºä¸€ä¸ªcommandå·²ç»æ”¾ç½®åˆ°ringä¸­ã€‚

	/* Updated by user. On its own cacheline */
	__u32 cmd_tail __attribute__((__aligned__(ALIGN_SIZE))); //ç”±ç”¨æˆ·ç©ºé—´ä¿®æ”¹ï¼Œè¡¨ç¤ºä¸€ä¸ªcommandå·²ç»å¤„ç†å®Œæˆã€‚

} __attribute__((packed));
</code></pre>
<h4 id="command-ring">Command Ring</h4>
<ul>
<li>Commandæ”¾ç½®åˆ° ring ä¸Šï¼Œkernel æ ¹æ® command çš„ size ç§»åŠ¨ mailbox.cmd_head æŒ‡é’ˆï¼Œå–æ¨¡ cmdr_sizeï¼Œå¹¶ä¸”é€šè¿‡ uio_event_notify() é€šçŸ¥ç”¨æˆ·ç©ºé—´ã€‚å½“å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œç”¨æˆ·ç©ºé—´æ›´æ–° mailbox.cmd_tailï¼Œå¹¶ä¸”é€šè¿‡ write() 4ä¸ªå­—èŠ‚é€šçŸ¥å†…æ ¸ã€‚å½“ cmd_head ç­‰äº cmd_tailï¼Œring ä¸ºç©º â€“ è¯´æ˜æ²¡æœ‰ command ç­‰å¾…ç”¨æˆ·ç©ºé—´å¤„ç†ã€‚</li>
<li>TCMU commands æ˜¯ 8 å­—èŠ‚å¯¹é½çš„ã€‚command ä»¥é€šç”¨ header èµ·å¤´ï¼Œheader åŒ…å«äº† len_opï¼Œ32 ä½çš„å€¼ï¼Œç”¨äºå­˜å‚¨ command çš„é•¿åº¦ï¼ŒåŒæ—¶ä½¿ç”¨äº†æœ€ä½çš„ 3 ä¸ª bit å­˜å‚¨æ“ä½œç  opcodeã€‚ä¹ŸåŒ…å«äº† cmd_id å’Œ flagsï¼Œç”±å†…æ ¸è®¾ç½®çš„kflags å’Œç”¨æˆ·ç©ºé—´è®¾ç½®çš„ uflagsã€‚</li>
<li>ç°åœ¨åªå®šä¹‰äº†ä¸¤ç§æ“ä½œç opcodeï¼š <code>TCMU_OP_CMD</code> å’Œ <code>TCMU_OP_PAD</code>ã€‚</li>
</ul>
<h5 id="tcmu_op_cmd">TCMU_OP_CMD</h5>
<ul>
<li>åœ¨command ringçš„ç»“æ„æ˜¯<code>struct tcmu_cmd_entry</code>ã€‚</li>
</ul>
<pre><code class="language-C">struct tcmu_cmd_entry {
	struct tcmu_cmd_entry_hdr hdr;

	union {
		struct {
			uint32_t iov_cnt;  // The size of iov array.
			uint32_t iov_bidi_cnt; // size of iov array for Data-In
			uint32_t iov_dif_cnt; //
			uint64_t cdb_off;  // Command data block offset
			uint64_t __pad1;
			uint64_t __pad2;
			struct iovec iov[0]; // iov array - buffer
		} req;
		
		struct {
			uint8_t scsi_status; // Command executed, return status.
			uint8_t __pad1;
			uint16_t __pad2;
			uint32_t __pad3;
			char sense_buffer[TCMU_SENSE_BUFFERSIZE]; // response data
		} rsp;
	};

} __attribute__((packed));


/*
 * Only a few opcodes, and length is 8-byte aligned, so use low bits for opcode.
 */
struct tcmu_cmd_entry_hdr {
	__u32 len_op;
	__u16 cmd_id;
	__u8 kflags;
#define TCMU_UFLAG_UNKNOWN_OP 0x1
	__u8 uflags;

} __attribute__((packed));
</code></pre>
<ul>
<li>ç”¨æˆ·ç©ºé—´é€šè¿‡tcmu_cmd_entry.req.cdb_offæ‰¾åˆ°SCSI CDBï¼ˆCommand Data Blockï¼‰ã€‚è¿™æ˜¯commandåœ¨æ•´ä¸ªå…±äº«å†…å­˜åŒºåŸŸèµ·å§‹ä½ç½®çš„åç§»é‡ï¼Œè€Œä¸æ˜¯ç»“æ„ä½“æˆ–ringä¸­çš„é‡Œé¢çš„åç§»é‡ã€‚</li>
<li>é€šè¿‡req.iov[]æ•°æ®è®¿é—®æ•°æ®åŒºåŸŸã€‚iov_cntåŒ…å«äº†iov[]ç»“æ„çš„æ•°é‡ï¼Œéœ€è¦åŒºåˆ†Data-Inè¿˜æ˜¯Data-Outçš„æ•°æ®ã€‚å¯¹äºåŒå‘çš„commandï¼Œiov_cntæŒ‡å®šå¤šå°‘iovecè¦†ç›–äº†Data-OutåŒºåŸŸï¼Œiov_bidi_cntæŒ‡å®šäº†å¤šå°‘iovecè¦†ç›–äº†Data-InåŒºåŸŸï¼ˆç´§æ¥åœ¨Data-OutåŒºåŸŸï¼‰ã€‚å°±åƒåˆ«çš„fieldä¸€æ ·ï¼Œiov.iov_baseæ˜¯ç›¸å¯¹äºå†…å­˜åŒºåŸŸèµ·å§‹ä½ç½®çš„åç§»é‡ã€‚</li>
<li>å½“commandæ‰§è¡Œå®Œæˆï¼Œç”¨æˆ·ç©ºé—´è®¾ç½®rsp.scsi_statusï¼Œå¦‚æœæœ‰éœ€è¦ä¹Ÿè®¾ç½®rsp.sense_bufferã€‚</li>
<li>ç”¨æˆ·ç©ºé—´æ ¹æ®entry.hdr.length(mod cmdr_size)å¢åŠ mailbox.cmd_tailï¼Œå¹¶ä¸”é€šè¿‡UIOæ–¹æ³•é€šçŸ¥å†…æ ¸ï¼Œ4å­—èŠ‚å†™åˆ°æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li>å¦‚æœè®¾ç½®TCMU_MAILBOX_FLAG_CAP_OOOCåˆ°mailbox-&gt;flagsï¼Œkernel å¯ä»¥å¤„ç† out-of-order completionsã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ç©ºé—´èƒ½å¤Ÿå¤„ç†ä¸æºå¤´ä¸åŒçš„é¡ºåºã€‚ç”±äºkernelå¤„ç†commandçš„é¡ºåºä¸command ringä¸­çš„ä¸€è‡´ï¼Œæ‰€ä»¥ç”¨æˆ·ç©ºé—´åœ¨commandæ‰§è¡Œå®Œæˆæ—¶ï¼Œéœ€è¦æ›´æ–°cmd-&gt;idã€‚</li>
</ul>
<h5 id="tcmu_op_pad">TCMU_OP_PAD</h5>
<ul>
<li>å½“æ“ä½œç opcodeæ˜¯PADï¼Œç”¨æˆ·ç©ºé—´åªä¼šæ›´æ–°cmd_tail -- å› ä¸ºæ˜¯ä¸€ä¸ªno-opã€‚kernel æ’å…¥PAD entries ç¡®ä¿æ¯ä¸ªCMD entryåœ¨command ringä¸­æ˜¯è¿ç»­çš„ã€‚</li>
<li>æœªæ¥ä¼šåŠ å…¥æ›´å¤šçš„opcodeã€‚å¦‚æœç”¨æˆ·ç©ºé—´é‡åˆ°ä¸€ä¸ªä¸èƒ½å¤„ç†çš„opcodeï¼Œå¿…é¡»è¦è®¾ç½® hdr.uflags çš„ç¬¬0ä¸ªbitä¸ºUNKNOWN_OPï¼Œæ›´æ–°cmd_tailï¼Œå¤„ç†é™„åŠ çš„commandsã€‚</li>
</ul>
<h4 id="data-area">Data Area</h4>
<ul>
<li>æ•°æ®åŒºåŸŸæ˜¯åœ¨command ringçš„åé¢ï¼ŒTCMUæ¥å£æ²¡æœ‰å®šä¹‰è¿™ç‰‡åŒºåŸŸçš„ç»“æ„ï¼Œç”¨æˆ·ç©ºé—´åº”è¯¥åªè®¿é—®pengding iovsæŒ‡å®šçš„åŒºåŸŸã€‚</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://github.com/zjs1224522500/files-and-images/blob/master/blog/pic/User-Kernel-Communication.png?raw=true" alt="image" loading="lazy"></figure>
<h3 id="tcmu-åŠ¨æ€é…ç½®åŠ è½½">TCMU åŠ¨æ€é…ç½®åŠ è½½</h3>
<ul>
<li>TCMU ä½¿ç”¨äº†ä¸€ä¸ªæ—¶åˆ»ç›‘å¬ TCMU é…ç½®æ–‡ä»¶çš„å®ˆæŠ¤è¿›ç¨‹æ¥æ£€æŸ¥é…ç½®æ–‡ä»¶çš„å˜åŒ–ï¼Œå¯¹åº”åœ°æ›´æ–° TCMU çš„ç›¸å…³é…ç½®ï¼Œè¯¸å¦‚æ—¥å¿—çº§åˆ«, æ—¥å¿—è¾“å‡ºè·¯å¾„ç­‰</li>
</ul>
<h3 id="tcmu-plugin-handler">TCMU Plugin Handler</h3>
<ul>
<li>ä¸ºäº†åœ¨ TCMU ç›¸å…³æ¥å£çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¤„ç†è‡ªå®šä¹‰åç«¯å­˜å‚¨çš„å¤„ç†æ–¹æ³•ï¼Œéœ€è¦è‡ªå®šä¹‰å®ç° TCMU Handler.</li>
</ul>
<pre><code class="language-C">struct tcmur_handler {
	const char *name;	/* Human-friendly name */
	const char *subtype;	/* Name for cfgstring matching */
	const char *cfg_desc;	/* Description of this backstore's config string */

	void *opaque;		/* Handler private data. */

	/*
	 * As much as possible, check that the cfgstring will result
	 * in a working device when given to us as dev-&gt;cfgstring in
	 * the -&gt;open() call.
	 *
	 * This function is optional but gives configuration tools a
	 * chance to warn users in advance if the device they're
	 * trying to create is invalid.
	 *
	 * Returns true if string is valid. Only if false, set *reason
	 * to a string that says why. The string will be free()ed.
	 * Suggest using asprintf().
	 */
	bool (*check_config)(const char *cfgstring, char **reason);

	int (*reconfig)(struct tcmu_device *dev, struct tcmulib_cfg_info *cfg);

	/* Per-device added/removed callbacks */
	int (*open)(struct tcmu_device *dev, bool reopen);
	void (*close)(struct tcmu_device *dev);

	/*
	 * If &gt; 0, runner will execute up to nr_threads IO callouts from
	 * threads.
	 * if 0, runner will call IO callouts from the cmd proc thread or
	 * completion context for compound commands.
	 */
	int nr_threads;

	/*
	 * Async handle_cmd only handlers return:
	 *
	 * - TCMU_STS_OK if the command has been executed successfully
	 * - TCMU_STS_NOT_HANDLED if opcode is not handled
	 * - TCMU_STS_ASYNC_HANDLED if opcode is handled asynchronously
	 * - Non TCMU_STS_OK code indicating failure
	 * - TCMU_STS_PASSTHROUGH_ERR For handlers that require low level
	 *   SCSI processing and want to setup their own sense buffers.
	 *
	 * Handlers that set nr_threads &gt; 0 and async handlers
	 * that implement handle_cmd and the IO callouts below return:
	 *
	 * - TCMU_STS_OK if the handler has queued the command.
	 * - TCMU_STS_NOT_HANDLED if the command is not supported.
	 * - TCMU_STS_NO_RESOURCE if the handler was not able to allocate
	 *   resources for the command.
	 *
	 * If TCMU_STS_OK is returned from the callout the handler must call
	 * the tcmulib_cmd-&gt;done function with TCMU_STS return code.
	 */
	handle_cmd_fn_t handle_cmd;

	/*
	 * Below callbacks are only executed by generic_handle_cmd.
	 * Returns:
	 * - TCMU_STS_OK if the handler has queued the command.
	 * - TCMU_STS_NO_RESOURCE if the handler was not able to allocate
	 *   resources for the command.
	 *
	 * If TCMU_STS_OK is returned from the callout the handler must call
	 * the tcmulib_cmd-&gt;done function with TCMU_STS return code.
	 */
	rw_fn_t write;
	rw_fn_t read;
	flush_fn_t flush;
	unmap_fn_t unmap;

	/*
	 * If the lock is acquired and the tag is not TCMU_INVALID_LOCK_TAG,
	 * it must be associated with the lock and returned by get_lock_tag on
	 * local and remote nodes. When unlock is successful, the tag
	 * associated with the lock must be deleted.
	 *
	 * Returns a TCMU_STS indicating success/failure.
	 */
	int (*lock)(struct tcmu_device *dev, uint16_t tag);
	int (*unlock)(struct tcmu_device *dev);

	/*
	 * Return tag set in lock call in tag buffer and a TCMU_STS
	 * indicating success/failure.
	 */
	int (*get_lock_tag)(struct tcmu_device *dev, uint16_t *tag);

	/*
	 * Must return TCMUR_DEV_LOCK state value.
	 */
	int (*get_lock_state)(struct tcmu_device *dev);

	/*
	 * internal field, don't touch this
	 *
	 * indicates to tcmu-runner whether this is an internal handler loaded
	 * via dlopen or an external handler registered via dbus. In the
	 * latter case opaque will point to a struct dbus_info.
	 */
	bool _is_dbus_handler;

	/*
	 * Update the logdir called by dynamic config thread.
	 */
	bool (*update_logdir)(void);
};
</code></pre>
<h4 id="å®ç°æ–¹å¼ä¸€-å…¨æƒæ¥ç®¡å‘½ä»¤å¤„ç†">å®ç°æ–¹å¼ä¸€  å…¨æƒæ¥ç®¡å‘½ä»¤å¤„ç†</h4>
<ul>
<li>ä»¥ <code>file_optical.c</code> ä¸ºä¾‹ï¼š</li>
</ul>
<pre><code class="language-C">/*
 * Return scsi status or TCMU_STS_NOT_HANDLED
 */
static int fbo_handle_cmd(struct tcmu_device *dev, struct tcmulib_cmd *cmd)
{
	uint8_t *cdb = cmd-&gt;cdb;
	struct iovec *iovec = cmd-&gt;iovec;
	size_t iov_cnt = cmd-&gt;iov_cnt;
	uint8_t *sense = cmd-&gt;sense_buf;
	struct fbo_state *state = tcmur_dev_get_private(dev);
	bool do_verify = false;
	int ret;

	/* Check for format in progress */
	/* Certain commands can be executed even if a format is in progress */
	if (state-&gt;flags &amp; FBO_FORMATTING &amp;&amp;
	    cdb[0] != INQUIRY &amp;&amp;
	    cdb[0] != REQUEST_SENSE &amp;&amp;
	    cdb[0] != GET_CONFIGURATION &amp;&amp;
	    cdb[0] != GPCMD_GET_EVENT_STATUS_NOTIFICATION) {
		tcmu_sense_set_key_specific_info(sense, state-&gt;format_progress);
		ret = TCMU_STS_FRMT_IN_PROGRESS;
		return ret;
	}

	switch(cdb[0]) {
	case TEST_UNIT_READY:
		ret = tcmu_emulate_test_unit_ready(cdb, iovec, iov_cnt);
		break;
	case REQUEST_SENSE:
		ret = fbo_emulate_request_sense(dev, cdb, iovec, iov_cnt, sense);
		break;
	case FORMAT_UNIT:
		ret = fbo_emulate_format_unit(dev, cdb, iovec, iov_cnt, sense);
		break;
	case READ_6:
	case READ_10:
	case READ_12:
		ret = fbo_read(dev, cdb, iovec, iov_cnt, sense);
		break;
	case WRITE_VERIFY:
		do_verify = true;
	case WRITE_6:
	case WRITE_10:
	case WRITE_12:
		ret = fbo_write(dev, cdb, iovec, iov_cnt, sense, do_verify);
		break;
	case INQUIRY:
		ret = fbo_emulate_inquiry(cdb, iovec, iov_cnt, sense);
		break;
	case MODE_SELECT:
	case MODE_SELECT_10:
		ret = fbo_emulate_mode_select(cdb, iovec, iov_cnt, sense);
		break;
	case MODE_SENSE:
	case MODE_SENSE_10:
		ret = fbo_emulate_mode_sense(cdb, iovec, iov_cnt, sense);
		break;
	case START_STOP:
		ret = tcmu_emulate_start_stop(dev, cdb);
		break;
	case ALLOW_MEDIUM_REMOVAL:
		ret = fbo_emulate_allow_medium_removal(dev, cdb, sense);
		break;
	case READ_FORMAT_CAPACITIES:
		ret = fbo_emulate_read_format_capacities(dev, cdb, iovec,
							 iov_cnt, sense);
		break;
	case READ_CAPACITY:
		if ((cdb[1] &amp; 0x01) || (cdb[8] &amp; 0x01))
			/* Reserved bits for MM logical units */
			return TCMU_STS_INVALID_CDB;
		else
			ret = tcmu_emulate_read_capacity_10(state-&gt;num_lbas,
							    state-&gt;block_size,
							    cdb, iovec,
							    iov_cnt);
		break;
	case VERIFY:
		ret = fbo_verify(dev, cdb, iovec, iov_cnt, sense);
		break;
	case SYNCHRONIZE_CACHE:
		ret = fbo_synchronize_cache(dev, cdb, sense);
		break;
	case READ_TOC:
		ret = fbo_emulate_read_toc(dev, cdb, iovec, iov_cnt, sense);
		break;
	case GET_CONFIGURATION:
		ret = fbo_emulate_get_configuration(dev, cdb, iovec, iov_cnt,
						    sense);
		break;
	case GPCMD_GET_EVENT_STATUS_NOTIFICATION:
		ret = fbo_emulate_get_event_status_notification(dev, cdb,
								iovec, iov_cnt,
								sense);
		break;
	case READ_DISC_INFORMATION:
		ret = fbo_emulate_read_disc_information(dev, cdb, iovec,
							iov_cnt, sense);
		break;
	case READ_DVD_STRUCTURE:
		ret = fbo_emulate_read_dvd_structure(dev, cdb, iovec, iov_cnt,
						     sense);
		break;
	case MECHANISM_STATUS:
		ret = fbo_emulate_mechanism_status(dev, cdb, iovec, iov_cnt,
						   sense);
		break;
	default:
		ret = TCMU_STS_NOT_HANDLED;
	}
	return ret;
}
</code></pre>
<h4 id="å®ç°æ–¹å¼äºŒ-ä»…å®ç°å…·ä½“çš„ioæ“ä½œ">å®ç°æ–¹å¼äºŒ  ä»…å®ç°å…·ä½“çš„IOæ“ä½œ</h4>
<ul>
<li>ä»¥ file.example.cä¸ºä¾‹</li>
</ul>
<pre><code class="language-C">/*
 * Copyright (c) 2014 Red Hat, Inc.
 *
 * This file is licensed to you under your choice of the GNU Lesser
 * General Public License, version 2.1 or any later version (LGPLv2.1 or
 * later), or the Apache License 2.0.
 */

/*
 * Example code to demonstrate how a TCMU handler might work.
 *
 * Using the example of backing a device by a file to demonstrate:
 *
 * 1) Registering with tcmu-runner
 * 2) Parsing the handler-specific config string as needed for setup
 * 3) Opening resources as needed
 * 4) Handling SCSI commands and using the handler API
 */

#define _GNU_SOURCE
#include &lt;stddef.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;endian.h&gt;
#include &lt;errno.h&gt;
#include &lt;scsi/scsi.h&gt;

#include &quot;scsi_defs.h&quot;
#include &quot;libtcmu.h&quot;
#include &quot;tcmu-runner.h&quot;
#include &quot;tcmur_device.h&quot;

struct file_state {
	int fd;
};

static int file_open(struct tcmu_device *dev, bool reopen)
{
	struct file_state *state;
	char *config;

	state = calloc(1, sizeof(*state));
	if (!state)
		return -ENOMEM;

    // Init the file state of tcmu
	tcmur_dev_set_private(dev, state);

    // Move the pointer to the first '/' location in path string
	config = strchr(tcmu_dev_get_cfgstring(dev), '/');
	if (!config) {
	tcmu_err(&quot;no configuration found in cfgstring\n&quot;);
		goto err;
	}	
	config += 1; /* get past '/' */

    // Enable the tcmu write cache.(Set the value of tcmu_device as true)
	tcmu_dev_set_write_cache_enabled(dev, 1);

    // Open the file with path.(With mode)
	state-&gt;fd = open(config, O_CREAT | O_RDWR, S_IRUSR | S_IWUSR);
	if (state-&gt;fd == -1) {
		tcmu_err(&quot;could not open %s: %m\n&quot;, config);
		goto err;
	}

	tcmu_dbg(&quot;config %s\n&quot;, tcmu_dev_get_cfgstring(dev));

	return 0;

err:
	free(state);
	return -EINVAL;
}

static void file_close(struct tcmu_device *dev)
{
	// Get the file state of tcmu_device.
	struct file_state *state = tcmur_dev_get_private(dev);

    // Close the file
	close(state-&gt;fd);

	// free the state
	free(state);
}

/**
 * 
 * @param *dev              tcmu device
 * @param *cmd              Command line interface.(not used in this method)
 * @param *iov              buffer array to syore the data
 * @param iov_cnt           buffer array size  
 * @param length            read length
 * @param offset            start address
 * 
 * return                   the size of read data.
 */
static int file_read(struct tcmu_device *dev, struct tcmulib_cmd *cmd,
		     struct iovec *iov, size_t iov_cnt, size_t length,
		     off_t offset)
{
	// Get the file state of tecmu_device
	struct file_state *state = tcmur_dev_get_private(dev);
	size_t remaining = length;
	ssize_t ret;

    // Read the file in loop
	while (remaining) {
		// Read the data and store in the iov array. Return the data size.
		ret = preadv(state-&gt;fd, iov, iov_cnt, offset);
		if (ret &lt; 0) {
			tcmu_err(&quot;read failed: %m\n&quot;);
			ret = TCMU_STS_RD_ERR;
			goto done;
		}

		if (ret == 0) {
			/* EOF, then zeros the iovecs left */
			tcmu_iovec_zero(iov, iov_cnt);
			break;
		}

        // Consume the iov array. 
		tcmu_iovec_seek(iov, ret);
		// Move the offset
		offset += ret;
		// Change the length and continute to read file.
		remaining -= ret;
	}
	// Read finished, and status is OK.
	ret = TCMU_STS_OK;
done:
	return ret;
}

/**
 * 
 * @param *dev              tcmu device
 * @param *cmd              Command line interface.(not used in this method)
 * @param *iov              buffer array to syore the data
 * @param iov_cnt           buffer array size  
 * @param length            write length
 * @param offset            start address
 * 
 * return                   the size of read data.
 */
static int file_write(struct tcmu_device *dev, struct tcmulib_cmd *cmd,
		      struct iovec *iov, size_t iov_cnt, size_t length,
		      off_t offset)
{
	// Get the file state of tecmu_device
	struct file_state *state = tcmur_dev_get_private(dev);
	size_t remaining = length;
	ssize_t ret;

    // Write the file in loop
	while (remaining) {
	    // Wirte the data in the iov array to file. Return the data size.
		ret = pwritev(state-&gt;fd, iov, iov_cnt, offset);
		if (ret &lt; 0) {
			tcmu_err(&quot;write failed: %m\n&quot;);
			ret = TCMU_STS_WR_ERR;
			goto done;
		}
		// Consume an inv array.
		tcmu_iovec_seek(iov, ret);
		// Move the offset.
		offset += ret;
		// Change the length and continue to write.
		remaining -= ret;
	}
	ret = TCMU_STS_OK;
done:
	return ret;
}

static int file_flush(struct tcmu_device *dev, struct tcmulib_cmd *cmd)
{
	// Get the file state of tcmu_device.
	struct file_state *state = tcmur_dev_get_private(dev);
	int ret;

	// Sync(Flush) the data in page cache to disk.
	if (fsync(state-&gt;fd)) {
		tcmu_err(&quot;sync failed\n&quot;);
		ret = TCMU_STS_WR_ERR;
		goto done;
	}
	ret = TCMU_STS_OK;
done:
	return ret;
}

static int file_reconfig(struct tcmu_device *dev, struct tcmulib_cfg_info *cfg)
{
	switch (cfg-&gt;type) {
	// Extend or Reduce the size of file.
	case TCMULIB_CFG_DEV_SIZE:
		/*
		 * TODO - For open/reconfig we should make sure the FS the
		 * file is on is large enough for the requested size. For
		 * now assume we can grow the file and return 0.
		 */
		return 0;
	case TCMULIB_CFG_DEV_CFGSTR:
	// Handle the write cache.
	case TCMULIB_CFG_WRITE_CACHE:
	default:
		return -EOPNOTSUPP;
	}
}

static const char file_cfg_desc[] =
	&quot;The path to the file to use as a backstore.&quot;;

// Init the tcmu_handler with given static method defined in this class.
static struct tcmur_handler file_handler = {
	.cfg_desc = file_cfg_desc,

	.reconfig = file_reconfig,

	.open = file_open,
	.close = file_close,
	.read = file_read,
	.write = file_write,
	.flush = file_flush,
	.name = &quot;File-backed Handler (example code)&quot;,
	.subtype = &quot;file&quot;,
	.nr_threads = 2,
};

/* Entry point must be named &quot;handler_init&quot;. */
int handler_init(void)
{
	// Regist the file_handler to running_handler list
	return tcmur_register_handler(&amp;file_handler);
}
</code></pre>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://pic.36krcnd.com/201804/20060915/yucn8kelclf6k0hj!1200');"></div>
                 <a href="https://blog.shunzi.tech/post/storage-basic-concept/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2019-07-20">2019-07-20</time>
                  <h4 class="title white no-margin">å­˜å‚¨åŸºæœ¬æ¦‚å¿µ</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://blog.shunzi.tech/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://docs.openstack.org/cinder/latest/_images/cinder.png');"></div>
                 <a href="https://blog.shunzi.tech/post/cinder/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2019-07-16">2019-07-16</time>
                  <h4 class="title white no-margin">Cinderæ ¸å¿ƒ</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://blog.shunzi.tech/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                <div class="clear"></div>
<script>
jQuery(document).ready(function($){
    $('.vemoji-btn').text('ğŸ˜€');
    $("#comments").on('click', 'span.vat',function(){
        $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
        $('textarea#veditor').focus();
    })
    if(window.location.hash){
        var checkExist = setInterval(function() {
            if ($(window.location.hash).length) {
                $('html, body').animate({scrollTop: $(window.location.hash).offset().top-200}, 600);
                clearInterval(checkExist);
            }
        }, 100);
    }
})
</script>

              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://blog.shunzi.tech/post/Dostoevsky/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20210112173749.png)');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2021-01-12">2021-01-12</time>
                      <h4 class="title usmall">
                        <a href="https://blog.shunzi.tech/post/Dostoevsky/">Dostoevsky: Better Space-Time Trade-Offs for LSM-Tree Based Key-Value Stores via Adaptive Removal of Superfluous Merging</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://blog.shunzi.tech/post/CRaft/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200614213040.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-12-16">2020-12-16</time>
                      <h4 class="title usmall">
                        <a href="https://blog.shunzi.tech/post/CRaft/">CRaft: An Erasure-coding-supported Version of Raft for Reducing Storage Cost and Network Cost</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://blog.shunzi.tech/post/Alluxio/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20201210191906.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-12-10">2020-12-10</time>
                      <h4 class="title usmall">
                        <a href="https://blog.shunzi.tech/post/Alluxio/">Alluxio</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://blog.shunzi.tech/tag/l8sKsLUAi/" class="ctag ctag-0 ctag-l8sKsLUAi" aria-label="">KVS</a>
                    
                      <a href="https://blog.shunzi.tech/tag/5uQUdLlSC/" class="ctag ctag-1 ctag-5uQUdLlSC" aria-label="">Paper</a>
                    
                      <a href="https://blog.shunzi.tech/tag/3zCwFWPHxH/" class="ctag ctag-2 ctag-3zCwFWPHxH" aria-label="">å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/geK0jEW-T/" class="ctag ctag-3 ctag-geK0jEW-T" aria-label="">åˆ†å¸ƒå¼</a>
                    
                      <a href="https://blog.shunzi.tech/tag/9msH-lUaA/" class="ctag ctag-4 ctag-9msH-lUaA" aria-label="">ç¼“å­˜</a>
                    
                      <a href="https://blog.shunzi.tech/tag/_jfuTNqah/" class="ctag ctag-5 ctag-_jfuTNqah" aria-label="">LSM</a>
                    
                      <a href="https://blog.shunzi.tech/tag/i2b42Y2j6/" class="ctag ctag-6 ctag-i2b42Y2j6" aria-label="">Ceph</a>
                    
                      <a href="https://blog.shunzi.tech/tag/la-n8a0mo/" class="ctag ctag-7 ctag-la-n8a0mo" aria-label="">è¯»ä¹¦ç¬”è®°</a>
                    
                      <a href="https://blog.shunzi.tech/tag/os/" class="ctag ctag-8 ctag-os" aria-label="">OS</a>
                    
                      <a href="https://blog.shunzi.tech/tag/oBVOD8v4ou/" class="ctag ctag-9 ctag-oBVOD8v4ou" aria-label="">ä¸€è‡´æ€§</a>
                    
                      <a href="https://blog.shunzi.tech/tag/gqgftpk_y/" class="ctag ctag-10 ctag-gqgftpk_y" aria-label="">AI</a>
                    
                      <a href="https://blog.shunzi.tech/tag/shu-ju-ku/" class="ctag ctag-11 ctag-shu-ju-ku" aria-label="">æ•°æ®åº“</a>
                    
                      <a href="https://blog.shunzi.tech/tag/n2w6bz87h/" class="ctag ctag-12 ctag-n2w6bz87h" aria-label="">ç¼–ç¨‹è¯­è¨€</a>
                    
                      <a href="https://blog.shunzi.tech/tag/ZnIN9Ge-w/" class="ctag ctag-13 ctag-ZnIN9Ge-w" aria-label="">å¯¹è±¡å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/4zx4ysLGro/" class="ctag ctag-14 ctag-4zx4ysLGro" aria-label="">äº‘è®¡ç®—</a>
                    
                      <a href="https://blog.shunzi.tech/tag/NgjQJdkc6/" class="ctag ctag-15 ctag-NgjQJdkc6" aria-label="">é¡¹ç›®</a>
                    
                      <a href="https://blog.shunzi.tech/tag/5h7k39FKw/" class="ctag ctag-16 ctag-5h7k39FKw" aria-label="">Cè¯­è¨€</a>
                    
                      <a href="https://blog.shunzi.tech/tag/c0aMcnBDAh/" class="ctag ctag-17 ctag-c0aMcnBDAh" aria-label="">C++</a>
                    
                      <a href="https://blog.shunzi.tech/tag/NF-h45xcE/" class="ctag ctag-18 ctag-NF-h45xcE" aria-label="">iscsi</a>
                    
                      <a href="https://blog.shunzi.tech/tag/Y_nsOD1At/" class="ctag ctag-19 ctag-Y_nsOD1At" aria-label="">SSD</a>
                    
                      <a href="https://blog.shunzi.tech/tag/E2d1yYZcV8/" class="ctag ctag-20 ctag-E2d1yYZcV8" aria-label="">è™šæ‹ŸåŒ–</a>
                    
                      <a href="https://blog.shunzi.tech/tag/PhD/" class="ctag ctag-21 ctag-PhD" aria-label="">Ph.D</a>
                    
                      <a href="https://blog.shunzi.tech/tag/ZqEqvRTvl/" class="ctag ctag-22 ctag-ZqEqvRTvl" aria-label="">ç½‘ç»œ</a>
                    
                      <a href="https://blog.shunzi.tech/tag/PuY19cs53/" class="ctag ctag-23 ctag-PuY19cs53" aria-label="">ä»¿çœŸ</a>
                    
                      <a href="https://blog.shunzi.tech/tag/rIIc9E-ZvN/" class="ctag ctag-24 ctag-rIIc9E-ZvN" aria-label="">ç³»ç»Ÿç»“æ„</a>
                    
                      <a href="https://blog.shunzi.tech/tag/fu-wu-qi/" class="ctag ctag-25 ctag-fu-wu-qi" aria-label="">æœåŠ¡å™¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/X-lnqf1Ex/" class="ctag ctag-26 ctag-X-lnqf1Ex" aria-label="">å®¹å™¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/hbaTDSglx-/" class="ctag ctag-27 ctag-hbaTDSglx-" aria-label="">å·¥å…·</a>
                    
                      <a href="https://blog.shunzi.tech/tag/EO3XpMf_y/" class="ctag ctag-28 ctag-EO3XpMf_y" aria-label="">Linux</a>
                    
                      <a href="https://blog.shunzi.tech/tag/diary/" class="ctag ctag-29 ctag-diary" aria-label="">Diary</a>
                    
                      <a href="https://blog.shunzi.tech/tag/DyzFtOe6x/" class="ctag ctag-30 ctag-DyzFtOe6x" aria-label="">è®¡ç®—æœºåŸºç¡€</a>
                    
                      <a href="https://blog.shunzi.tech/tag/oqE3oKihb/" class="ctag ctag-31 ctag-oqE3oKihb" aria-label="">OpenStack</a>
                    
                      <a href="https://blog.shunzi.tech/tag/p_z7gKe6R/" class="ctag ctag-32 ctag-p_z7gKe6R" aria-label="">ä¸­é—´ä»¶</a>
                    
                      <a href="https://blog.shunzi.tech/tag/Test/" class="ctag ctag-33 ctag-Test" aria-label="">æµ‹è¯•</a>
                    
                      <a href="https://blog.shunzi.tech/tag/Product-Standard/" class="ctag ctag-34 ctag-Product-Standard" aria-label="">Product Standard</a>
                    
                      <a href="https://blog.shunzi.tech/tag/spring/" class="ctag ctag-35 ctag-spring" aria-label="">Spring</a>
                    
                      <a href="https://blog.shunzi.tech/tag/she-ji-mo-shi/" class="ctag ctag-36 ctag-she-ji-mo-shi" aria-label="">è®¾è®¡æ¨¡å¼</a>
                    
                      <a href="https://blog.shunzi.tech/tag/mian-jing/" class="ctag ctag-37 ctag-mian-jing" aria-label="">é¢ç»</a>
                    
                      <a href="https://blog.shunzi.tech/tag/suan-fa/" class="ctag ctag-38 ctag-suan-fa" aria-label="">ç®—æ³•</a>
                    
                      <a href="https://blog.shunzi.tech/tag/redis/" class="ctag ctag-39 ctag-redis" aria-label="">Redis</a>
                    
                      <a href="https://blog.shunzi.tech/tag/javaweb/" class="ctag ctag-40 ctag-javaweb" aria-label="">JavaWeb</a>
                    
                      <a href="https://blog.shunzi.tech/tag/KyMCZj2Wl/" class="ctag ctag-41 ctag-KyMCZj2Wl" aria-label="">WEBå®¹å™¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/javase/" class="ctag ctag-42 ctag-javase" aria-label="">JavaSE</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://blog.shunzi.tech/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">Elvis Zhang</a></h4>
                    <p class="founder">The easy way or the right way.</p>
                    <div class="social">
                      
                          
                            <a href="https://github.com/zjs1224522500" class="translate-effect" target="_blank"><i class="fa fa-github"></i></a>
                        
                      
                          
                            <a href="https://twitter.com/1224522500Elvis" class="translate-effect" target="_blank"><i class="fa fa-twitter"></i></a>
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://blog.shunzi.tech"><img src="\media\images\custom-footerLogo.jpg" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2019 å…± 107 ç¯‡æ–‡ç« 
          <br/>
          Theme <a href="https://gridea.dev/" target="_blank">ã€Œbreekã€</a> Powered by <a href="https://gridea.dev/" target="_blank">ã€ŒGrideaã€</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/valine/1.3.10/Valine.Pure.min.js"></script>
<script>
    new Valine({
        el: '#comments',
        appId: 'Pj5H1z0w7hJlLGJpGBh9NrCq-MdYXbMMI' ,
        appKey: 'LdR8vK5EaBfK87esF7tlbsXe',
        pageSize: 30,
        placeholder: 'æ—¢ç„¶æ¥äº†ï¼Œé‚£å°±ç•™ä¸ªç—•è¿¹å§~',
        visitor: true // é˜…è¯»é‡ç»Ÿè®¡
    })
</script>
    

      
    <script src="https://blog.shunzi.tech/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
