<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    Elvis Zhang
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="Elvis">
<meta name="description" content="The easy way or the right way!">
<meta name="keywords" content="Dead">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://blog.shunzi.tech/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--点击特效-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDN样式-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
                                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143818020-1"></script>
                                <script>
                                    window.dataLayer = window.dataLayer || [];

                                    function gtag() {
                                        dataLayer.push(arguments);
                                    }
                                    gtag('js', new Date());
                                    gtag('config', 'UA-143818020-1');
                                </script>
                                
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://blog.shunzi.tech">
                    Elvis Zhang
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        主页
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        归档
                    </a>
                    
                    <a class="menu-item" href="/tag/diary">
                        随笔
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        标签
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        关于
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1623475546024" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://blog.shunzi.tech">
                            Elvis Zhang
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1623475546024" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            主页
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            归档
                        </a>
                        
                        <a class="menu-item" href="/tag/diary">
                            随笔
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            标签
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            关于
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                Flavor of IO
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            Elvis Zhang
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2020-06-12</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">11.3
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">1822</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://blog.shunzi.tech/tag/3zCwFWPHxH/">存储</a>
                                
                            </span>
                                            
                                                阅读量:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                            <img class="post-feature-image" src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612094331.png" alt="">
                          
                        <div class="post-content">
                            <blockquote>
<ul>
<li>Distributed Storage System Basic Serie 1 - Flavor of IO.</li>
</ul>
</blockquote>
<!-- more -->
<blockquote>
<ul>
<li>Distributed Storage System Basic Serie 1 - Flavor of IO.</li>
<li>Here is the basic of linux io and try to compare io operations.</li>
<li>The content is based on the <a href="https://medium.com/databasss/on-disk-io-part-1-flavours-of-io-8e1ace1de017">On Disk IO - Flavors of IO</a> and I will present my understanding.</li>
<li>Only summary, not details.</li>
</ul>
</blockquote>
<h2 id="disk-io">Disk I/O</h2>
<h3 id="flavors-of-io">Flavors of I/O</h3>
<ul>
<li>Syscalls: open, write, read, fsync, sync, close
<ul>
<li>System I/O can be defined as any operation that writes data into the storage layers accessible only to the kernel's address space via the kernel's system call interface.</li>
</ul>
</li>
<li>Standard IO: fopen, fwrite, fread, fflush, fclose
<ul>
<li>Usually provided by library</li>
<li>Writes using these functions may not result in system calls, meaning that the data still lives in buffers in the application's address space after making such a function call.</li>
</ul>
</li>
<li>Vectored IO: writev, readv</li>
<li>Memory mapped IO: open, mmap, msync, munmap
<ul>
<li>similar to the system I/O</li>
<li>Files are still opened and closed using the same interfaces, but access to the file data is performed by mapping that data into the process' address space, and then performing memory read and write operations as you would with any other application buffer.</li>
</ul>
</li>
</ul>
<h4 id="io-api">I/O API</h4>
<h5 id="system-io">System I/O</h5>
<ul>
<li>Open: <code>open()</code>, <code>creat()</code></li>
<li>Write: <code>write()</code>, <code>aio_write()</code>, <code>pwrite()</code>, <code>pwritev()</code></li>
<li>Sync: <code>fsync()</code>, <code>sync()</code></li>
<li>Close: <code>close()</code></li>
</ul>
<h5 id="stream-io">Stream I/O</h5>
<ul>
<li>
<p>Open: <code>fopen()</code>, <code>fdopen()</code>, <code>freopen()</code></p>
</li>
<li>
<p>Write: <code>fwrite()</code>, <code>fputc()</code>, <code>fputs()</code>, <code>putc()</code>, <code>putchar()</code>, <code>puts()</code></p>
</li>
<li>
<p>Sync: <code>fflush()</code>, followed by <code>fsync()</code> or <code>sync()</code></p>
<ul>
<li><code>fflush()</code> flush the data in library cache to the disk (actual page cache)</li>
<li><code>fsync()</code> flush the data in page cache to disks and metedata to disks. (Usually contains 2 operations: data and metedata)</li>
<li><code>fdatasync()</code> flush the data definitely and flush the metedata if necessary.(Such as the file size changed.)</li>
</ul>
</li>
<li>
<p>Close: <code>fclose()</code></p>
</li>
</ul>
<h5 id="memory-mapped-io">Memory mapped IO</h5>
<ul>
<li>Open: <code>open()</code>, <code>creat()</code></li>
<li>Map: <code>mmap()</code></li>
<li>Write: <code>memcpy()</code>, <code>memmove()</code>, <code>read()</code>, or any other routine that writes to application memory</li>
<li>Sync: <code>msync()</code></li>
<li>Unmap: <code>munmap()</code></li>
<li>Close: <code>close()</code></li>
</ul>
<h4 id="sectorblockpage">Sector/Block/Page</h4>
<ul>
<li>Sector is the smallest unit of data transfer for block device. And size is always 512 bytes in most disk devices.</li>
<li>The smallest addressable unit of File System is block. Block is a group of multiple adjacent sectors requested by a device driver. 512/1024/2048/4096 bytes.</li>
<li>Virtual Memory works with pages, which map to filesystem blocks. Typical page size is 4096 bytes. (Usually IO is done through the Virtual Memory, which caches requested filesystem blocks in memory and serves as a buffer for intermediate operations)</li>
<li><strong>Virtual Memory pages map to Filesystem blocks, which map to Block Device sectors.</strong></li>
</ul>
<h4 id="standard-io">Standard IO</h4>
<ul>
<li>When reading the data, Page Cache is addressed first. If the data is absent, the Page Fault is triggered and contents are paged in. (This means that reads, performed against the currently unmapped area will take longer)</li>
<li>During writes, buffer contents are first written to Page Cache. ( This means that data does not reach the disk right away. The actual hardware write is done when Kernel decides it’s time to perform a writeback of the dirty page)</li>
<li>Standard IO takes a user space buffer (Byte Buffer) and then copies it’s content to the page cache. <strong>When the O_DIRECT flag is used, the buffer is written directly to the block device. (It means O_DIRECT will not use page cache)</strong></li>
<li>Byte Buffer in Application is implemented by application to try to align with single page(4K) in Page Cache. (For example, in program, we usually create a buffer array to send/receive data)<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612092724.png" alt="20200612092724" loading="lazy"></li>
</ul>
<h5 id="page-cache">Page Cache</h5>
<ul>
<li>Page Cache stores the recently accessed fragments of files that are more likely to be accessed in the nearest time.</li>
<li>How Buffered IO works: Applications perform reads and writes through the Kernel Page Cache, which allows sharing pages processes, serving reads from cache and throttling writes to reduce IO.<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612094331.png" alt="20200612094331" loading="lazy"></li>
<li>Read OP:
<ul>
<li>Cache Miss: block device -&gt; kernel page cache -&gt; application</li>
<li>Cache Hit: kernel page cache -&gt; application</li>
<li>Cache evict/flush: LRU Pages (Least Recently Used)</li>
</ul>
</li>
<li>Write OP:
<ul>
<li>application -&gt; kernel page cache (Mark Page Dirty) -&gt; (Wait Flush/Writeback) disk</li>
<li>Flush/Writeback Strategy: thresholds of dirty page; period flush.
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/sysctl/vm.txt">https://www.kernel.org/doc/Documentation/sysctl/vm.txt</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Temporal locality principle (时间局部性原理)</strong>: Recently accessed pages will be accessed again at some point in nearest future.</li>
<li><strong>Spatial Locality (空间局部性)</strong>: implies that the elements physically located nearby have a good chance of being located close to each other. This principle is used in a process called “prefetch” that loads file contents ahead of time anticipating their access and amortizing some of the IO costs.</li>
<li><strong>Page Cache also improves IO performance by delaying writes and coalescing adjacent reads.</strong></li>
<li><strong>Buffer cache is same as page cache in recent years.</strong></li>
</ul>
<h5 id="direct-io">Direct IO</h5>
<ul>
<li>Direct IO: Bypass the Page Cache, and offer a fine-grained control over IO operations. Most used in systems which implement cache by self.</li>
<li>PostgreSQL use direct io in WAL, since they are sure this log data will not be reused immediately.<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612112115.png" alt="20200612112115" loading="lazy"></li>
<li><strong>Notice: <code>fsync()</code> is still required for files opened with O_DIRECT in order to save the data to stable storage</strong>.
<ul>
<li>It is decided by specific file system and operations. Some file systems contain metadata cache, if you create a new file, you should write all data and metadata to disks, but <code>O_DIRECT</code> option only can make sure the data be stored on the disk. The metadata stored in file system cache need other sync operations to be flushed to disks.</li>
<li>Some operations may not change the metadata, so O_DIRECT option can make sure data be flushed to disk right although without <code>fsync()</code>. So in MySQL configuration, you can set different options for <code>innodb_flush_method</code>, such as <code>O_DIRECT</code>, <code>O_DIRECT_NO_FSYNC</code>. You can view details by clicking <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_flush_method">https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_flush_method</a></li>
<li>You can refer <a href="https://zhuanlan.zhihu.com/p/134669835">Zhihu：使用O_DIRECT_NO_FSYNC来提升MySQL性能</a></li>
</ul>
</li>
</ul>
<h5 id="block-alignment">Block Alignment</h5>
<ul>
<li>Unaligned writes.<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612113237.png" alt="20200612113237" loading="lazy"></li>
<li>Aligned writes.<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612113305.png" alt="20200612113305" loading="lazy"></li>
<li><strong>Whether or not O_DIRECT flag is used, it is always a good idea to make sure your reads and writes are block aligned.</strong> Although page cache will help to make sure write is aligned.</li>
</ul>
<h5 id="nonblocking-filesystem-io">Nonblocking FileSystem IO</h5>
<ul>
<li><strong>There’s no true “nonblocking” Filesystem IO</strong>.</li>
<li>Compared with sockets i/o, block device operations are considered non-blocking. Filesystem IO delays are not taken into account by the system. Possibly this decision was made because there’s a more or less hard time bound on operation completion.</li>
<li>The <strong>NIO</strong> concept is always used in network.</li>
</ul>
<h4 id="memory-mapping">Memory Mapping</h4>
<ul>
<li><strong>Memory mapping (mmap) allows you to access a file as if it was loaded in memory entirely.</strong><br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612114554.png" alt="20200612114554" loading="lazy"></li>
<li>Different mode:
<ul>
<li>private mmap: write would trigger copy-on-write of the page in question in order to leave the original page intact and keep the changes private.</li>
<li>shared mmap: the file mapping is shared with other processes so they can see updates to the mapped memory segment. Additionally, changes are carried through to the underlying file (precise control over which requires the use of <strong>msync</strong>).</li>
</ul>
</li>
<li>Memory Space Allocate: Lazy Manner. First I/O operation trigger a page fault and allocate the appropriate page.</li>
<li>Adavantages and Disadvantages:
<ul>
<li>Advantages:
<ul>
<li>Avoid creating an extraneous copy of the buffer in memory</li>
<li>Avoid system call (less subsequent context switch)</li>
</ul>
</li>
<li>Disadvatages:
<ul>
<li>imposes overhead of the kernel data structures required for managing the memory mappings</li>
<li>Memory-mapped file size limit: Most of the time, the kernel code is much more memory-friendly anyways and 64 bit architectures allow mapping larger files.</li>
</ul>
</li>
</ul>
</li>
<li>Usage: MongoDB default storage engine was mmap-backed.</li>
</ul>
<h4 id="page-cache-optimization">Page cache optimization</h4>
<ul>
<li>Page case is at the cost of control loss.</li>
<li>One of the ways of informing the kernel about your intentions is using <strong>fadvise</strong>.
<ul>
<li>FADV_SEQUENTIAL specifies that the file is read sequentially, from lower offsets to higher ones, so the kernel can make sure to fetch the pages in advance, before the actual read occurs.</li>
<li>FADV_RANDOM disables read-ahead, evicting pages that are unlikely to be accessed any time soon from the page cache.</li>
<li>FADV_WILLNEED notifies the OS that the page will be needed by the process in the near future. This gives the kernel an opportunity to cache the page ahead of time and, when the read operation occurs, to serve it from the page cache instead of page-faulting.</li>
<li>FADV_DONTNEED advises the kernel that it can free the cache for the corresponding pages (making sure that the data is synchronised with the disk beforehand).</li>
<li>There’s one more flag (FADV_NOREUSE), but on Linux it has no effect.</li>
</ul>
</li>
<li><strong>Just as the name suggests, fadvise is only acting advisory. The kernel is not obligated to do exactly as fadvise suggests.</strong></li>
<li>Usage: RocksDB</li>
<li>call <strong>mlock</strong>: It allows you to force pages to be held in memory. This means that once the page is loaded into memory, all subsequent operations will be served from the page cache.</li>
</ul>
<h4 id="aio">AIO</h4>
<ul>
<li>Asynchronous IO (AIO). AIO is an interface allowing to initiate multiple IO operations and register callbacks that will be triggered on their completion.</li>
</ul>
<h5 id="io_submit">io_submit</h5>
<ul>
<li>allows passing one or multiple commands, holding a buffer, offset and an operation that has to be performed.</li>
</ul>
<h5 id="io_getevents">io_getevents</h5>
<ul>
<li>Completions can be queried by using <code>io_getevents</code>, a call that allows to collect result events for corresponding commands.</li>
</ul>
<h5 id="others">Others</h5>
<ul>
<li>Linux AIO has several shortcomings:
<ul>
<li>the syscalls API isn’t exposed by the glibc and requires a library for wiring them up (libaio seems to be the most popular)</li>
<li>Despite several attempts to fix that, only file descriptors with O_DIRECT flag are supported, so buffered asynchronous operations won’t work. Besides, some operations, such as stat, fsync, open and some others aren’t fully asynchronou</li>
</ul>
</li>
<li>Differences between <strong>Linux AIO</strong> and <strong>POSIX AIO</strong>
<ul>
<li>The Posix AIO implementation on Linux is implemented completely in user space and does not use this Linux-specific AIO subsystem at all.</li>
</ul>
</li>
</ul>
<h4 id="vectored-io">Vectored IO</h4>
<ul>
<li>One, possibly less popular, method of performing IO operations is Vectored IO (also known as Scatter/Gather). It is called this way because it operates on a vector of buffers and allows reading and writing data to/from disk using multiple buffers per system call.<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200612134338.png" alt="20200612134338" loading="lazy"></li>
</ul>
<h5 id="advantages">Advantages</h5>
<ul>
<li>Such an approach can help by allowing reading smaller chunks (therefore avoiding allocation of large memory areas for contiguous blocks).</li>
<li>Reduce the amount of system calls required to fill up all these buffers with data from disk</li>
<li>Reads and writes are atomic: The kernel prevents other processes from performing IO on the same descriptor during read and write operations, guaranteeing data integrity.</li>
</ul>
<h5 id="usage">Usage</h5>
<ul>
<li>A few databases use the Vectored IO. This might be because general purpose databases work with a bunch of files simultaneously, trying to guarantee liveness for each running operation and reduce their latencies, so and data is accessed and cached block-wise.</li>
<li>Vectored IO is more useful for analytics workloads and/or columnar databases, where the data is stored on disk contiguously, and its processing can be done in parallel in sparse blocks. One of the examples is Apache Arrow.</li>
</ul>
<h3 id="reference">Reference</h3>
<ul>
<li>Ensuring data reaches disk: <a href="https://lwn.net/Articles/457667/">https://lwn.net/Articles/457667/</a></li>
</ul>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#disk-io">Disk I/O</a>
<ul>
<li><a href="#flavors-of-io">Flavors of I/O</a>
<ul>
<li><a href="#io-api">I/O API</a>
<ul>
<li><a href="#system-io">System I/O</a></li>
<li><a href="#stream-io">Stream I/O</a></li>
<li><a href="#memory-mapped-io">Memory mapped IO</a></li>
</ul>
</li>
<li><a href="#sectorblockpage">Sector/Block/Page</a></li>
<li><a href="#standard-io">Standard IO</a>
<ul>
<li><a href="#page-cache">Page Cache</a></li>
<li><a href="#direct-io">Direct IO</a></li>
<li><a href="#block-alignment">Block Alignment</a></li>
<li><a href="#nonblocking-filesystem-io">Nonblocking FileSystem IO</a></li>
</ul>
</li>
<li><a href="#memory-mapping">Memory Mapping</a></li>
<li><a href="#page-cache-optimization">Page cache optimization</a></li>
<li><a href="#aio">AIO</a>
<ul>
<li><a href="#io_submit">io_submit</a></li>
<li><a href="#io_getevents">io_getevents</a></li>
<li><a href="#others">Others</a></li>
</ul>
</li>
<li><a href="#vectored-io">Vectored IO</a>
<ul>
<li><a href="#advantages">Advantages</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>Elvis Zhang</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://blog.shunzi.tech/post/flavor-of-io/">https://blog.shunzi.tech/post/flavor-of-io/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR 码" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://blog.shunzi.tech/post/flavor-of-io/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.shunzi.tech/post/flavor-of-io/&sharesource=qzone&title=Flavor of IO&pics=https://blog.shunzi.tech/images/avatar.png?v=1623475546024&summary=&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Distributed Storage System Basic Serie 1 - Flavor of IO.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
"><i class="fa fa-qq"></i></a>
                                                                    <a title="新浪微博" target="_blank" href="https://service.weibo.com/share/share.php?url=https://blog.shunzi.tech/post/flavor-of-io/&sharesource=weibo&title=Flavor of IO + " - " + &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Distributed Storage System Basic Serie 1 - Flavor of IO.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&pic="https://blog.shunzi.tech/images/avatar.png?v=1623475546024 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://blog.shunzi.tech/tag/3zCwFWPHxH/">#
                    存储
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://blog.shunzi.tech/post/amplification-and-rum/">
                                                                                            Amplification and RUM
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://blog.shunzi.tech/post/distributed-storage-system-basic/">
                                                                                                    Distributed Storage System Basic
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: 'Pj5H1z0w7hJlLGJpGBh9NrCq-MdYXbMMI',
        appKey: 'LdR8vK5EaBfK87esF7tlbsXe',
        pageSize: 5,
        avatar: 'mp',
        placeholder: '来都来了，不妨评论一下',
        visitor: false,
        highlight: false,
        recordIP: false,
    })
</script>
                                                    
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        Elvis Zhang &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://github.com/" target="_blank">
                                                Github Pages
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.6
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1623475546024);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>