<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>S3FS | Elvis Zhang</title>
<meta name="description" content="The easy way or the right way." />
<link rel="shortcut icon" href="https://blog.shunzi.tech/favicon.ico">
<link rel="stylesheet" href="https://blog.shunzi.tech/styles/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

<script data-ad-client="ca-pub-7661668224317940" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script src="https://blog.shunzi.tech/media/js/jquery.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/masonry.pkgd.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/aos.js"></script>
<script src="https://blog.shunzi.tech/media/js/pace.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/view-image.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://blog.shunzi.tech/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="

FUSE-based file system backed by Amazon S3
åŸºäºå¯¹è±¡å­˜å‚¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå›½å†…æœ‰ aliyun/ossfs, huaweicloud/obsfs
æœ¬è´¨æ˜¯å®ç°äº†å°†å¯¹è±¡å­˜å‚¨çš„ Bucket æŒ‚è½½åˆ°äº†æœ¬åœ°æ–‡..." />
    <meta name="keywords" content="å­˜å‚¨,å¯¹è±¡å­˜å‚¨,äº‘è®¡ç®—" />
    <script src="https://blog.shunzi.tech/media/js/waterfall.min.js"></script>
    <script src="https://blog.shunzi.tech/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://blog.shunzi.tech"><img src="\media\images\custom-headerLogo.jpg" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://blog.shunzi.tech" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tag/diary" class="menu">
                      éšç¬”
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/movies" class="menu">
                      è§‚å½±
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/post/about" class="menu">
                      å…³äº
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1610809361880" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200522175313.png');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2020-05-22"><i class="fa fa-calendar"></i><span class="lately">8 ä¸ªæœˆå‰</span></time>
              
              <a href="https://blog.shunzi.tech/post/s3fs/#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/s3fs/"> </span>
              </a>
              <span id="/s3fs/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://blog.shunzi.tech/tag/3zCwFWPHxH/" class="ctag ctag-0 ctag-3zCwFWPHxH" aria-label="">å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/ZnIN9Ge-w/" class="ctag ctag-1 ctag-ZnIN9Ge-w" aria-label="">å¯¹è±¡å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/4zx4ysLGro/" class="ctag ctag-2 ctag-4zx4ysLGro" aria-label="">äº‘è®¡ç®—</a>
                    
              </div>
              <h1 class="title ularge white bold">S3FS</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <blockquote>
<ul>
<li>FUSE-based file system backed by Amazon S3</li>
<li>åŸºäºå¯¹è±¡å­˜å‚¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå›½å†…æœ‰ aliyun/ossfs, huaweicloud/obsfs</li>
<li>æœ¬è´¨æ˜¯å®ç°äº†å°†å¯¹è±¡å­˜å‚¨çš„ Bucket æŒ‚è½½åˆ°äº†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä»è€Œé€šè¿‡æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ“ä½œ OSS ä¸Šçš„å¯¹è±¡</li>
</ul>
</blockquote>
<!-- more -->
<h1 id="s3fs">S3FS</h1>
<ul>
<li><a href="https://github.com/s3fs-fuse/s3fs-fuse">S3FS Github Repo</a></li>
<li><a href="https://manpages.ubuntu.com/manpages/xenial/man1/s3fs.1.html">Ubuntu Man Page S3FS</a></li>
</ul>
<h2 id="overfiew">Overfiew</h2>
<ul>
<li>S3FS æ˜¯ä¸€ä¸ª FUSE æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå…è®¸æ‚¨å°† Amazon S3 bucket æŒ‚è½½ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒåœ¨ S3 ä¸­ä»¥è‡ªç„¶å’Œé€æ˜çš„æ–¹å¼å­˜å‚¨æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å…¶ä»–ç¨‹åºæ¥è®¿é—®ç›¸åŒçš„æ–‡ä»¶)ã€‚s3fs å¯ä»¥å¤„ç†çš„å¯¹è±¡çš„æœ€å¤§å¤§å°å–å†³äº Amazon S3ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨å•ä¸€ PUT API æ—¶ï¼Œå¯ä»¥è¾¾åˆ° 5GBã€‚å½“ä½¿ç”¨å¤šéƒ¨åˆ†ä¸Šä¼  API æ—¶ï¼Œæœ€å¤šæ”¯æŒ 5TBã€‚</li>
<li>s3fs æ˜¯ç¨³å®šçš„ï¼Œå¹¶åœ¨è®¸å¤šç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œ<a href="https://blog.csdn.net/qq_32706349/article/details/91451053">rsync</a> å¤‡ä»½åˆ° s3ã€‚</li>
</ul>
<h2 id="dependency">Dependency</h2>
<h3 id="fuse">FUSE</h3>
<ul>
<li>FUSE: File System In User Space. ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿï¼Œå®ç°é€»è¾‘å¯ä»¥åœ¨ç”¨æˆ·æ€å±‚é¢ä»£ç é«˜åº¦å®šåˆ¶ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„å†…æ ¸æ–‡ä»¶ç³»ç»Ÿå¦‚ Ext4 ç­‰ï¼Œæ˜“ç”¨æ€§æ›´é«˜ï¼Œæ•ˆç‡å› ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„é¢‘ç¹åˆ‡æ¢ç›¸å¯¹è¾ƒä½ã€‚</li>
<li>å†…æ ¸å¿…é¡»æ”¯æŒ FUSE, 2.6.18-164 ä¹‹å‰çš„å†…æ ¸å¯èƒ½ä¸æ”¯æŒ FUSEã€‚è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨(VPS)å¯èƒ½æ²¡æœ‰åœ¨å…¶å†…æ ¸ä¸­ç¼–è¯‘ FUSE æ”¯æŒã€‚</li>
<li><a href="https://my.oschina.net/fileoptions/blog/2996339">é»‘å®¢ç”»å®¶ï¼šä»€ä¹ˆæ˜¯ FUSEï¼Ÿ</a></li>
</ul>
<h3 id="s3-standard-object-storage">S3 Standard Object Storage</h3>
<ul>
<li>ç”±äºæ˜¯åŸºäºå¯¹è±¡å­˜å‚¨æ„å»ºçš„å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¯¹è±¡å­˜å‚¨ç³»ç»Ÿï¼ŒS3FS åˆ™æ˜¯é’ˆå¯¹å®ç°äº† S3 æ ‡å‡†çš„å¯¹è±¡å­˜å‚¨æ„å»ºçš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ul>
<h2 id="features">Features</h2>
<ul>
<li>æ”¯æŒPOSIX æ–‡ä»¶ç³»ç»Ÿçš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ–‡ä»¶è¯»å†™ï¼Œç›®å½•ï¼Œé“¾æ¥æ“ä½œï¼Œæƒé™ï¼Œ uid/gidï¼Œä»¥åŠæ‰©å±•å±æ€§ï¼ˆextended attributesï¼‰</li>
<li>æ”¯æŒéšæœºå†™å’Œè¿½åŠ å†™</li>
<li>å¤§æ–‡ä»¶ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ </li>
<li>é€šè¿‡åœ¨æœåŠ¡ç«¯æ‹·è´å®ç° rename</li>
<li>MD5 æ•°æ®å®Œæ•´æ€§æ ¡éªŒ</li>
<li>å†…å­˜ç¼“å­˜å…ƒæ•°æ®</li>
<li>æœ¬åœ°ç£ç›˜æ•°æ®ç¼“å­˜</li>
<li>...</li>
</ul>
<h2 id="limitations">Limitations</h2>
<p>ä¸èƒ½å®Œå…¨ç­‰ä»·äºå†…æ ¸æ€çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ— è®ºæ˜¯æ€§èƒ½è¿˜æ˜¯è¯­ä¹‰æ”¯æŒæ–¹é¢éƒ½å­˜åœ¨ä¸€å®šå·®è·ã€‚</p>
<ul>
<li>éšæœºå†™å’Œè¿½åŠ å†™å¯èƒ½å¯¼è‡´æ•´ä¸ªæ–‡ä»¶çš„é‡å†™ï¼Œå¯ä»¥ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ è¿›è¡Œä¼˜åŒ–</li>
<li>å…ƒæ•°æ®çš„ç›¸å…³æ“ä½œï¼Œä¾‹å¦‚æšä¸¾ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºè¦è®¿é—®å¯¹è±¡å­˜å‚¨</li>
<li>åº•å±‚å¯¹è±¡å­˜å‚¨ç³»ç»Ÿçš„æœ€ç»ˆä¸€è‡´æ€§å¯èƒ½ä¼šä½¿å¾— S3FS æš‚æ—¶äº§ç”Ÿä¸€äº›è¿‡æ—¶çš„æ•°æ®</li>
<li>æ–‡ä»¶/æ–‡ä»¶å¤¹çš„renameæ“ä½œä¸æ˜¯åŸå­çš„ã€‚</li>
<li>å¤šå®¢æˆ·ç«¯æŒ‚è½½åŒä¸€ä¸ª Bucket æ—¶éœ€è¦åè°ƒå„ä¸ªå®¢æˆ·ç«¯çš„è¡Œä¸ºï¼Œé¿å…å¯¹ä¸€ä¸ªæ–‡ä»¶çš„ä¸åŒå®¢æˆ·ç«¯çš„å¹¶å‘å†™</li>
<li>ä¸æ”¯æŒ hard link</li>
<li>ä¸é€‚åˆç”¨åœ¨é«˜å¹¶å‘è¯»/å†™çš„åœºæ™¯ï¼Œè¿™æ ·ä¼šè®©ç³»ç»Ÿçš„ load å‡é«˜</li>
</ul>
<h2 id="åŸç†">åŸç†</h2>
<h3 id="æœºåˆ¶">æœºåˆ¶</h3>
<h4 id="1è¯»å–æ–‡ä»¶">1.è¯»å–æ–‡ä»¶</h4>
<ul>
<li>
<p>S3FS å¯¹äºæ–‡ä»¶çš„å­˜å‚¨åˆ†ä¸ºä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜ä¸¤ç§æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ use_cache å‚æ•°æŒ‡å®šç¼“å­˜ç›®å½•æ¥å¯åŠ¨ç¼“å­˜æ–¹å¼ã€‚</p>
</li>
<li>
<p>ç”¨æˆ·é€šè¿‡ offset å’Œ size æ¥è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„ç‰¹å®šåŒºåŸŸï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰ç›¸åº”çš„å†…å®¹ S3FS ä¼šé€šè¿‡ç½‘ç»œè¯·æ±‚ S3 ä¸Šçš„ç›¸åº”å†…å®¹ï¼Œå¹¶ä¸”å°†å¯¹åº”çš„å†…å®¹å­˜å‚¨åˆ°æœ¬åœ°çš„ä¸´æ—¶æ–‡ä»¶æˆ–è€…ç¼“å­˜ä¸­ã€‚</p>
</li>
</ul>
<h4 id="2æ–‡ä»¶é€»è¾‘æ¶æ„">2.æ–‡ä»¶é€»è¾‘æ¶æ„</h4>
<ul>
<li>ä¸ç®¡æ˜¯ä¸´æ—¶æ–‡ä»¶è¿˜æ˜¯ç¼“å­˜æ–‡ä»¶ï¼ŒS3FS éƒ½ç”¨åŒä¸€ä¸ªé€»è¾‘æ¶æ„ç»„ç»‡è¿™ä¸ªæ–‡ä»¶ï¼ŒS3FS ä½¿ç”¨ä¸€ä¸ªé¡µçš„åˆ—è¡¨æ¥ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯é¡µéƒ½æ˜¯è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼š<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200522113024.png" alt="20200522113024" loading="lazy"></li>
</ul>
<h5 id="ç»„æˆ"><strong>ç»„æˆ</strong>ï¼š</h5>
<ul>
<li>FDPage: ä»£è¡¨äº†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„ä¸€é¡µï¼Œå³ä¹Ÿæ˜¯æ–‡ä»¶ä¸­çš„éƒ¨åˆ†å†…å®¹ã€‚</li>
</ul>
<pre><code class="language-C++">//------------------------------------------------
// fdpage &amp; PageList
//------------------------------------------------
// page block information
struct fdpage
{
  off_t  offset;    // åç§»é‡
  off_t  bytes;     // é¡µçš„å¤§å° 
  bool   loaded;    // æ˜¯å¦åŠ è½½åˆ°äº†æœ¬åœ°
  bool   modified;  // æ˜¯å¦ä¿®æ”¹

  // æ„é€ å‡½æ•°
  fdpage(off_t start = 0, off_t  size = 0, bool is_loaded = false, bool is_modified = false)
           : offset(start), bytes(size), loaded(is_loaded), modified(is_modified) {}

  // è·å–ä¸‹ä¸€é¡µå¯¹åº”çš„åç§»é‡
  off_t next(void) const { return (offset + bytes); }
  // è·å–è¯¥é¡µçš„æœ«å°¾å¯¹åº”çš„åç§»é‡
  off_t end(void) const { return (0 &lt; bytes ? offset + bytes - 1 : 0); }
};
// Page List
typedef std::list&lt;struct fdpage&gt; fdpage_list_t;
</code></pre>
<ul>
<li>PageListï¼šä»£è¡¨ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼Œå®ƒæ˜¯ FDPage çš„ä¸€ä¸ªé“¾è¡¨ã€‚</li>
</ul>
<pre><code class="language-C++">class PageList
{
  friend class FdEntity;    // only one method access directly pages.

  private:
    fdpage_list_t pages;

  public:
    // é¡µçŠ¶æ€æšä¸¾
    enum page_status{
      PAGE_NOT_LOAD_MODIFIED = 0,
      PAGE_LOADED,
      PAGE_MODIFIED,
      PAGE_LOAD_MODIFIED
    };

  private:
    void Clear(void);
    bool Compress(bool force_modified = false);
    bool Parse(off_t new_pos);
    bool RawGetUnloadPageList(fdpage_list_t&amp; dlpages, off_t offset, off_t size);

  public:
    static void FreeList(fdpage_list_t&amp; list);

    explicit PageList(off_t size = 0, bool is_loaded = false, bool is_modified = false);
    explicit PageList(const PageList&amp; other);
    ~PageList();

    bool Init(off_t size, bool is_loaded, bool is_modified);
    off_t Size(void) const;
    bool Resize(off_t size, bool is_loaded, bool is_modified);

    bool IsPageLoaded(off_t start = 0, off_t size = 0) const;                  // size=0 is checking to end of list
    bool SetPageLoadedStatus(off_t start, off_t size, PageList::page_status pstatus = PAGE_LOADED, bool is_compress = true);
    bool FindUnloadedPage(off_t start, off_t&amp; resstart, off_t&amp; ressize) const;
    off_t GetTotalUnloadedPageSize(off_t start = 0, off_t size = 0) const;    // size=0 is checking to end of list
    int GetUnloadedPages(fdpage_list_t&amp; unloaded_list, off_t start = 0, off_t size = 0) const;  // size=0 is checking to end of list
    bool GetLoadPageListForMultipartUpload(fdpage_list_t&amp; dlpages);
    bool GetMultipartSizeList(fdpage_list_t&amp; mplist, off_t partsize) const;

    bool IsModified(void) const;
    bool ClearAllModified(void);

    bool Serialize(CacheFileStat&amp; file, bool is_output, ino_t inode);
    void Dump(void);
};
</code></pre>
<ul>
<li>FdEntityï¼šå¯¹ä¸€ä¸ªæ–‡ä»¶çš„å…¨é¢æè¿°ï¼ŒåŒ…æ‹¬é¡µé“¾è¡¨ã€æœ¬åœ°æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶è·¯å¾„ç­‰ã€‚</li>
</ul>
<pre><code class="language-C++">class FdEntity
{
  private:
    static bool     mixmultipart;   // whether multipart uploading can use copy api.

    pthread_mutex_t fdent_lock;
    bool            is_lock_init;
    int             refcnt;         // reference count ç”¨äºåˆ·å›
    std::string     path;           // object path
    int             fd;             // file descriptor(tmp file or cache file)
    FILE*           pfile;          // file pointer(tmp file or cache file)
    ino_t           inode;          // inode number for cache file
    headers_t       orgmeta;        // original headers at opening
    off_t           size_orgmeta;   // original file size in original headers

    pthread_mutex_t fdent_data_lock;// protects the following members
    PageList        pagelist;
    std::string     upload_id;      // for no cached multipart uploading when no disk space
    etaglist_t      etaglist;       // for no cached multipart uploading when no disk space
    off_t           mp_start;       // start position for no cached multipart(write method only)
    off_t           mp_size;        // size for no cached multipart(write method only)
    std::string     cachepath;      // local cache file path
                                    // (if this is empty, does not load/save pagelist.)
    std::string     mirrorpath;     // mirror file path to local cache file path

  private:
    static int FillFile(int fd, unsigned char byte, off_t size, off_t start);
    static ino_t GetInode(int fd);

    void Clear(void);
    ino_t GetInode(void);
    int OpenMirrorFile(void);
    bool SetAllStatus(bool is_loaded);                          // [NOTE] not locking
    //bool SetAllStatusLoaded(void) { return SetAllStatus(true); }
    bool SetAllStatusUnloaded(void) { return SetAllStatus(false); }

  public:
    static bool SetNoMixMultipart(void);

    explicit FdEntity(const char* tpath = NULL, const char* cpath = NULL);
    ~FdEntity();

    void Close(void);
    bool IsOpen(void) const { return (-1 != fd); }
    int Open(headers_t* pmeta = NULL, off_t size = -1, time_t time = -1, bool no_fd_lock_wait = false);
    bool OpenAndLoadAll(headers_t* pmeta = NULL, off_t* size = NULL, bool force_load = false);
    int Dup(bool lock_already_held = false);

    const char* GetPath(void) const { return path.c_str(); }
    bool RenamePath(const std::string&amp; newpath, std::string&amp; fentmapkey);
    int GetFd(void) const { return fd; }
    bool IsModified(void) const { return pagelist.IsModified(); }

    bool GetStats(struct stat&amp; st, bool lock_already_held = false);
    int SetCtime(time_t time);
    int SetMtime(time_t time, bool lock_already_held = false);
    bool UpdateCtime(void);
    bool UpdateMtime(void);
    bool GetSize(off_t&amp; size);
    bool SetMode(mode_t mode);
    bool SetUId(uid_t uid);
    bool SetGId(gid_t gid);
    bool SetContentType(const char* path);

    int Load(off_t start = 0, off_t size = 0, bool lock_already_held = false, bool is_modified_flag = false);  // size=0 means loading to end
    int NoCacheLoadAndPost(off_t start = 0, off_t size = 0);   // size=0 means loading to end
    int NoCachePreMultipartPost(void);
    int NoCacheMultipartPost(int tgfd, off_t start, off_t size);
    int NoCacheCompleteMultipartPost(void);

    int RowFlush(const char* tpath, bool force_sync = false);
    int Flush(bool force_sync = false) { return RowFlush(NULL, force_sync); }

    ssize_t Read(char* bytes, off_t start, size_t size, bool force_load = false);
    ssize_t Write(const char* bytes, off_t start, size_t size);

    bool ReserveDiskSpace(off_t size);
};
typedef std::map&lt;std::string, class FdEntity*&gt; fdent_map_t;   // key=path, value=FdEntity*
</code></pre>
<h3 id="io-æµç¨‹">IO æµç¨‹</h3>
<h4 id="è¯»å–æ–‡ä»¶æµç¨‹">è¯»å–æ–‡ä»¶æµç¨‹</h4>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200522171537.png" alt="20200522171537" loading="lazy"></figure>
<ul>
<li>ä¸å¯ç”¨ç¼“å­˜æ¨¡å¼ï¼šä¸å¯ç”¨ç¼“å­˜æ¨¡å¼ä¸‹ï¼ŒS3FS ä¼šåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥å­˜å‚¨ç½‘ç»œä¼ é€è¿‡æ¥çš„æ•°æ®ï¼Œè¯»å–ç»“æŸåå…³é—­ç›¸åº”çš„å¥æŸ„ï¼Œè¿™æ ·åšå¾—å¥½å¤„æ˜¯å¦‚æœå¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»å–åŒä¸€ä¸ªæ–‡ä»¶å°±ä¸éœ€è¦é¢‘ç¹çš„å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå½“è¿™ä¸ªä¸´æ—¶æ–‡ä»¶çš„æ‰€æœ‰å¥æŸ„éƒ½å…³é—­åè¿™ä¸ªä¸´æ—¶æ–‡ä»¶ä¹Ÿä¼šåˆ é™¤ã€‚</li>
</ul>
<pre><code class="language-C++">if(0 == refcnt){
      AutoLock auto_data_lock(&amp;fdent_data_lock);
      if(!cachepath.empty()){
        // [NOTE]
        // Compare the inode of the existing cache file with the inode of
        // the cache file output by this object, and if they are the same,
        // serialize the pagelist.
        //
        ino_t cur_inode = GetInode();
        if(0 != cur_inode &amp;&amp; cur_inode == inode){
          CacheFileStat cfstat(path.c_str());
          if(!pagelist.Serialize(cfstat, true, inode)){
            S3FS_PRN_WARN(&quot;failed to save cache stat file(%s).&quot;, path.c_str());
          }
        }
      }
      if(pfile){
        fclose(pfile);
        pfile = NULL;
      }
      fd    = -1;
      inode = 0;

      if(!mirrorpath.empty()){
        if(-1 == unlink(mirrorpath.c_str())){
          S3FS_PRN_WARN(&quot;failed to remove mirror cache file(%s) by errno(%d).&quot;, mirrorpath.c_str(), errno);
        }
        mirrorpath.erase();
      }
</code></pre>
<ul>
<li>å¯ç”¨ç¼“å­˜æ¨¡å¼ï¼šå¯ç”¨ç¼“å­˜æ¨¡å¼ä¸‹ï¼ŒS3FS ä¼šå°† S3 çš„æ•°æ®åœ¨æœ¬åœ°ç¼“å­˜ä¸€ä»½ï¼Œå¦‚æœç£ç›˜ç©ºé—´ä¸å¤Ÿï¼ŒS3FS ä¼šåˆ é™¤éƒ¨åˆ†æ²¡æœ‰è¿æ¥çš„æ–‡ä»¶æ¥é¢„ç•™å‡ºç£ç›˜ç©ºé—´ã€‚å¯¹äºéœ€è¦ç»å¸¸è®¿é—®çš„æ–‡ä»¶ï¼Œæœ‰ä¸€ä»½åœ¨æœ¬åœ°çš„ç¼“å­˜éå¸¸æœ‰å¿…è¦ã€‚</li>
</ul>
<h5 id="read-op">Read OP</h5>
<pre><code class="language-C++">ssize_t FdEntity::Read(char* bytes, off_t start, size_t size, bool force_load)
{
  S3FS_PRN_DBG(&quot;[path=%s][fd=%d][offset=%lld][size=%zu]&quot;, path.c_str(), fd, static_cast&lt;long long int&gt;(start), size);

  if(-1 == fd){
    return -EBADF;
  }
  AutoLock auto_lock(&amp;fdent_data_lock);

  if(force_load){
    pagelist.SetPageLoadedStatus(start, size, PageList::PAGE_NOT_LOAD_MODIFIED);
  }

  ssize_t rsize;

  // check disk space
  if(0 &lt; pagelist.GetTotalUnloadedPageSize(start, size)){
    // load size(for prefetch)
    size_t load_size = size;
    if(start + static_cast&lt;ssize_t&gt;(size) &lt; pagelist.Size()){
      ssize_t prefetch_max_size = max(static_cast&lt;off_t&gt;(size), S3fsCurl::GetMultipartSize() * S3fsCurl::GetMaxParallelCount());

      if(start + prefetch_max_size &lt; pagelist.Size()){
        load_size = prefetch_max_size;
      }else{
        load_size = pagelist.Size() - start;
      }
    }

    if(!ReserveDiskSpace(load_size)){
      S3FS_PRN_WARN(&quot;could not reserve disk space for pre-fetch download&quot;);
      load_size = size;
      if(!ReserveDiskSpace(load_size)){
        S3FS_PRN_ERR(&quot;could not reserve disk space for pre-fetch download&quot;);
        return -ENOSPC;
      }
    }

    // Loading
    int result = 0;
    if(0 &lt; size){
      result = Load(start, load_size, /*lock_already_held=*/ true);
    }

    FdManager::FreeReservedDiskSpace(load_size);

    if(0 != result){
      S3FS_PRN_ERR(&quot;could not download. start(%lld), size(%zu), errno(%d)&quot;, static_cast&lt;long long int&gt;(start), size, result);
      return -EIO;
    }
  }
  // Reading
  if(-1 == (rsize = pread(fd, bytes, size, start))){
    S3FS_PRN_ERR(&quot;pread failed. errno(%d)&quot;, errno);
    return -errno;
  }
  return rsize;
}
</code></pre>
<h5 id="write-op">Write OP</h5>
<pre><code class="language-C++">ssize_t FdEntity::Write(const char* bytes, off_t start, size_t size)
{
  S3FS_PRN_DBG(&quot;[path=%s][fd=%d][offset=%lld][size=%zu]&quot;, path.c_str(), fd, static_cast&lt;long long int&gt;(start), size);

  if(-1 == fd){
    return -EBADF;
  }
  // check if not enough disk space left BEFORE locking fd
  if(FdManager::IsCacheDir() &amp;&amp; !FdManager::IsSafeDiskSpace(NULL, size)){
    FdManager::get()-&gt;CleanupCacheDir();
  }
  AutoLock auto_lock(&amp;fdent_data_lock);

  // check file size
  if(pagelist.Size() &lt; start){
    // grow file size
    if(-1 == ftruncate(fd, start)){
      S3FS_PRN_ERR(&quot;failed to truncate temporary file(%d).&quot;, fd);
      return -EIO;
    }
    // add new area
    pagelist.SetPageLoadedStatus(pagelist.Size(), start - pagelist.Size(), PageList::PAGE_MODIFIED);
  }

  int     result = 0;
  ssize_t wsize;

  if(0 == upload_id.length()){
    // check disk space
    off_t restsize = pagelist.GetTotalUnloadedPageSize(0, start) + size;
    if(ReserveDiskSpace(restsize)){
      // enough disk space

      // Load uninitialized area which starts from 0 to (start + size) before writing.
      if(!FdEntity::mixmultipart){
        if(0 &lt; start){
          result = Load(0, start, /*lock_already_held=*/ true);
        }
      }

      FdManager::FreeReservedDiskSpace(restsize);
      if(0 != result){
        S3FS_PRN_ERR(&quot;failed to load uninitialized area before writing(errno=%d)&quot;, result);
        return static_cast&lt;ssize_t&gt;(result);
      }
    }else{
      // no enough disk space
      if(0 != (result = NoCachePreMultipartPost())){
        S3FS_PRN_ERR(&quot;failed to switch multipart uploading with no cache(errno=%d)&quot;, result);
        return static_cast&lt;ssize_t&gt;(result);
      }
      // start multipart uploading
      if(0 != (result = NoCacheLoadAndPost(0, start))){
        S3FS_PRN_ERR(&quot;failed to load uninitialized area and multipart uploading it(errno=%d)&quot;, result);
        return static_cast&lt;ssize_t&gt;(result);
      }
      mp_start = start;
      mp_size  = 0;
    }
  }else{
    // already start multipart uploading
  }

  // Writing
  if(-1 == (wsize = pwrite(fd, bytes, size, start))){
    S3FS_PRN_ERR(&quot;pwrite failed. errno(%d)&quot;, errno);
    return -errno;
  }
  if(0 &lt; wsize){
    pagelist.SetPageLoadedStatus(start, wsize, PageList::PAGE_LOAD_MODIFIED);
  }

  // Load uninitialized area which starts from (start + size) to EOF after writing.
  if(!FdEntity::mixmultipart){
    if(pagelist.Size() &gt; start + static_cast&lt;off_t&gt;(size)){
      result = Load(start + size, pagelist.Size(), /*lock_already_held=*/ true);
      if(0 != result){
        S3FS_PRN_ERR(&quot;failed to load uninitialized area after writing(errno=%d)&quot;, result);
        return static_cast&lt;ssize_t&gt;(result);
      }
    }
  }

  // check multipart uploading
  if(0 &lt; upload_id.length()){
    mp_size += wsize;
    if(S3fsCurl::GetMultipartSize() &lt;= mp_size){
      // over one multipart size
      if(0 != (result = NoCacheMultipartPost(fd, mp_start, mp_size))){
        S3FS_PRN_ERR(&quot;failed to multipart post(start=%lld, size=%lld) for file(%d).&quot;, static_cast&lt;long long int&gt;(mp_start), static_cast&lt;long long int&gt;(mp_size), fd);
        return result;
      }
      // [NOTE]
      // truncate file to zero and set length to part offset + size
      // after this, file length is (offset + size), but file does not use any disk space.
      //
      if(-1 == ftruncate(fd, 0) || -1 == ftruncate(fd, (mp_start + mp_size))){
        S3FS_PRN_ERR(&quot;failed to truncate file(%d).&quot;, fd);
        return -EIO;
      }
      mp_start += mp_size;
      mp_size   = 0;
    }
  }
  return wsize;
}
</code></pre>
<h4 id="è¯»å–æ–‡ä»¶ç½‘ç»œè¯·æ±‚æµç¨‹">è¯»å–æ–‡ä»¶ç½‘ç»œè¯·æ±‚æµç¨‹</h4>
<ul>
<li>é€šè¿‡ç½‘ç»œè¯·æ±‚ S3 çš„æ•°æ®ï¼ŒS3FS åˆ†ä¸ºäº†ä¸¤ç§ï¼Œä¸€ç§æ˜¯å•æ¬¡è¯·æ±‚ï¼Œä¸€ç§æ˜¯å¤šæ¬¡è¯·æ±‚ï¼Œè¯·æ±‚æµç¨‹å¦‚ä¸‹ï¼š<br>
<img src="https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200522171651.png" alt="20200522171651" loading="lazy"></li>
<li>å•æ¬¡è¯·æ±‚ï¼šé»˜è®¤æƒ…å†µä¸‹å•æ¬¡è¯·æ±‚çš„å¤§å°åœ¨ 20M ä»¥ä¸‹ï¼ŒS3FS ä¼šé€šè¿‡å•ä¸ªè¯·æ±‚å®Œæˆæ•°æ®çš„è¯·æ±‚ã€‚</li>
<li>å¤šæ¬¡è¯·æ±‚ï¼šé»˜è®¤æƒ…å†µä¸‹å¦‚æœè¯·æ±‚çš„æ•°æ®åœ¨ 20M ä»¥ä¸Šï¼ŒS3FS ä¼šåˆ‡å‰²æ•°æ®è¿›è¡Œå¤šæ¬¡è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚ 10M çš„æ•°æ®ï¼Œå¯¹å•ä¸ªæ–‡ä»¶çš„è¯·æ±‚æ¯æ¬¡æœ€å¤šå¯åŠ¨ 5 ä¸ªçº¿ç¨‹æ¥è¿›è¡Œæ•°æ®çš„è·å–ï¼Œå¹¶ä¸”æ˜¯åœ¨ 5 ä¸ªçº¿ç¨‹éƒ½è¯·æ±‚å®Œæˆåæ‰ä¼šå¯åŠ¨ä¸‹ä¸€è½®è¯·æ±‚ã€‚</li>
</ul>
<h5 id="è¯·æ±‚-s3">è¯·æ±‚ S3</h5>
<pre><code class="language-C++">int FdEntity::Load(off_t start, off_t size, bool lock_already_held, bool is_modified_flag)
{
  AutoLock auto_lock(&amp;fdent_lock, lock_already_held ? AutoLock::ALREADY_LOCKED : AutoLock::NONE);

  S3FS_PRN_DBG(&quot;[path=%s][fd=%d][offset=%lld][size=%lld]&quot;, path.c_str(), fd, static_cast&lt;long long int&gt;(start), static_cast&lt;long long int&gt;(size));

  if(-1 == fd){
    return -EBADF;
  }
  AutoLock auto_data_lock(&amp;fdent_data_lock, lock_already_held ? AutoLock::ALREADY_LOCKED : AutoLock::NONE);

  int result = 0;

  // check loaded area &amp; load
  fdpage_list_t unloaded_list;
  if(0 &lt; pagelist.GetUnloadedPages(unloaded_list, start, size)){
    for(fdpage_list_t::iterator iter = unloaded_list.begin(); iter != unloaded_list.end(); ++iter){
      if(0 != size &amp;&amp; start + size &lt;= iter-&gt;offset){
        // reached end
        break;
      }
      // check loading size
      off_t need_load_size = 0;
      if(iter-&gt;offset &lt; size_orgmeta){
        // original file size(on S3) is smaller than request.
        need_load_size = (iter-&gt;next() &lt;= size_orgmeta ? iter-&gt;bytes : (size_orgmeta - iter-&gt;offset));
      }

      // download
      if(S3fsCurl::GetMultipartSize() &lt;= need_load_size &amp;&amp; !nomultipart){
        // parallel request
        result = S3fsCurl::ParallelGetObjectRequest(path.c_str(), fd, iter-&gt;offset, need_load_size);
      }else{
        // single request
        if(0 &lt; need_load_size){
          S3fsCurl s3fscurl;
          result = s3fscurl.GetObjectRequest(path.c_str(), fd, iter-&gt;offset, need_load_size);
        }else{
          result = 0;
        }
      }
      if(0 != result){
        break;
      }
      // Set loaded flag
      pagelist.SetPageLoadedStatus(iter-&gt;offset, iter-&gt;bytes, (is_modified_flag ? PageList::PAGE_LOAD_MODIFIED : PageList::PAGE_LOADED));
    }
    PageList::FreeList(unloaded_list);
  }
  return result;
}
</code></pre>
<h3 id="æºç ">æºç </h3>
<h4 id="åŸç†æ¦‚è¿°">åŸç†æ¦‚è¿°ï¼š</h4>
<ul>
<li>ä»£ç å±‚é¢ s3fs çš„å®ç°æ–¹æ³•ä¸»è¦æ˜¯ï¼šåˆ©ç”¨ fuse åº“å®ç°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå¹¶æŒ‚è½½åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æŸä¸ªç›®å½•ä¸‹ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿçš„åº•å±‚å¹¶ä¸ä½¿ç”¨ç£ç›˜å­˜å‚¨ï¼Œè€Œæ˜¯ä½¿ç”¨ s3 os å­˜å‚¨(å› ä¸ºæ–‡ä»¶ç³»ç»Ÿæ˜¯è‡ªå·±å®ç°çš„ï¼Œç”¨ä»€ä¹ˆå­˜å‚¨ï¼Œæ€ä¹ˆå­˜å‚¨å¯ä»¥è‡ªå·±å®š)ï¼›</li>
</ul>
<h4 id="ä»£ç ç»“æ„">ä»£ç ç»“æ„</h4>
<ul>
<li>s3fs é¡¹ç›®ä¸€å…±æœ‰ 11 ä¸ªå¤´æ–‡ä»¶ï¼Œé™¤å»ä¸€ä¸ªæµ‹è¯•ä»£ç æ–‡ä»¶ï¼Œä¸€å…±æœ‰10ä¸ªæ–‡ä»¶ç³»ç»Ÿå®ç°ç›¸å…³çš„æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š
<ul>
<li>curl.hï¼šç”¨äºè¯·æ±‚s3 osä¸­çš„æ–‡ä»¶ï¼Œå¤šçº¿ç¨‹</li>
<li>fdcache.hï¼šç¼“å­˜æ–‡ä»¶ç›¸å…³ç±»ï¼ŒåŒ…æ‹¬fdpageã€pagelistã€FdEntityã€FdManagerï¼Œä¸»è¦ç”¨äºosä¸­æ–‡ä»¶åˆ†é¡µç¼“å­˜åˆ°æœ¬åœ°ä»¥åŠç¼“å­˜æ–‡ä»¶çš„ç›¸å…³ç®¡ç†(æ¯”å¦‚æ£€æŸ¥å­˜åœ¨ã€åˆ›å»ºã€æ¸…é™¤ç­‰) æ³¨æ„ï¼Œè‹¥æ–‡ä»¶å¥æŸ„æŒæœ‰çº¿ç¨‹ä¸º0ï¼Œåˆ™è¯¥æ–‡ä»¶ç¼“å­˜è¢«æ¸…é™¤ï¼›</li>
<li>psemaphore.hï¼šä¿¡å·é‡æœºåˆ¶å®ç°ç±»</li>
<li>s3fs.hï¼šs3æ–‡ä»¶ç³»ç»Ÿå®ç°ç±»ï¼Œç”¨äºåˆ©ç”¨s3 os ä¸ºå­˜å‚¨ä»‹è´¨ï¼Œæ„é€ ä¸€ä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸­</li>
<li>s3fs_util.hï¼šä¸€äº›å·¥å…·ç±»</li>
<li>s3fs_auth.hï¼šç”¨äºs3 osçš„è®¤è¯</li>
<li>string_util.hï¼šç”¨äºå¤„ç†httpåè®®çš„(header,body)</li>
<li>cache.hï¼šæ–‡ä»¶ç¼“å­˜ï¼Œå°†å·²è¯»å–æˆ–åŠ è½½çš„æ–‡ä»¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œä»¥å¤‡ä»¥åä½¿ç”¨(ç›¸å½“äºcpuçš„ä¸‰çº§ç¼“å­˜)</li>
<li>common.hï¼šä¸»è¦ç”¨äºæ—¥å¿—è®°å½•</li>
<li>add_head.h</li>
</ul>
</li>
</ul>
<h2 id="åŒç±»äº§å“">åŒç±»äº§å“</h2>
<h3 id="ossfs-alicloud">ossfs AliCloud</h3>
<ul>
<li><a href="https://help.aliyun.com/document_detail/32196.html?spm=a2c4g.11174283.6.756.50c77da25kXUri">å®˜æ–¹ä»‹ç»</a></li>
<li><a href="https://github.com/aliyun/ossfs">Github Repo</a></li>
<li>ossfs èƒ½è®©æ‚¨åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå°†å¯¹è±¡å­˜å‚¨OSSçš„å­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰æŒ‚è½½åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‚¨èƒ½å¤Ÿåƒæ“ä½œæœ¬åœ°æ–‡ä»¶ä¸€æ ·æ“ä½œOSSçš„å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå®ç°æ•°æ®çš„å…±äº«ã€‚</li>
</ul>
<h3 id="obsfs-huaweicloud">obsfs HuaweiCloud</h3>
<ul>
<li><a href="https://support.huaweicloud.com/fstg-obs/obs_12_0001.html">å®˜æ–¹ä»‹ç»</a></li>
<li><a href="https://github.com/huaweicloud/huaweicloud-obs-obsfs">Github Repo</a></li>
<li>Obsfs æ˜¯åŸºäºå¼€æº s3fs ä¿®æ”¹çš„ã€‚Obsfs ç»§æ‰¿äº† s3fs çš„ä¸€äº›åŠŸèƒ½ï¼Œå¹¶ä¸ºåä¸ºäº‘OBSæœåŠ¡å¼€å‘äº†ä¸€äº›ç‹¬ç‰¹çš„åŠŸèƒ½ã€‚obsfs å…è®¸ Linux å’Œ Mac OS X é€šè¿‡ FUSE æŒ‚è½½ S3 bucketã€‚</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/kahing/goofys">goofys</a> - similar to s3fs but has better performance and less POSIX compatibility. <strong>Performance First, POSIX Second</strong>
<ul>
<li>We can try to implement self-define backend object storage service. But we must use Go-Language to call functions given by our object operations sdk.</li>
</ul>
</li>
<li>s3acker - mount an S3 bucket as a single file</li>
<li>S3Proxy - combine with s3fs to mount Backblaze B2, EMC Atmos, Microsoft Azure, and OpenStack Swift buckets.
<ul>
<li>It is used as a S3 Proxy for other object storage service and implements S3 API.</li>
</ul>
</li>
<li>s3ql - similar to s3fs but uses its own object format</li>
<li>YAS3FS - similar to s3fs but uses SNS to allow multiple clients to mount a bucket</li>
</ul>
<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://aws.amazon.com/cn/blogs/china/s3fs-amazon-ec2-linux/">[1] AWS: åˆ©ç”¨ S3fs åœ¨Amazon EC2 Linux å®ä¾‹ä¸ŠæŒ‚è½½ S3 å­˜å‚¨æ¡¶</a></li>
<li><a href="https://blog.csdn.net/THMAIL/article/details/103567262">[2] CSDN: s3fs å®ç°åŸç†å‰–æ</a></li>
<li><a href="https://blog.didiyun.com/index.php/2019/01/02/s3fs/">[3] æ»´æ»´äº‘ï¼šåŸºäºæ»´æ»´äº‘æ­å»º S3FS åŠå…¶å®ç°æœºåˆ¶å‰–æ</a></li>
</ul>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200611220832.png');"></div>
                 <a href="https://blog.shunzi.tech/post/head-first-go-lang/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2020-06-11">2020-06-11</time>
                  <h4 class="title white no-margin">Head First Golang</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://blog.shunzi.tech/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/BigTable_database_large.jpg');"></div>
                 <a href="https://blog.shunzi.tech/post/BigTable-A-Distributed-Storage-System-for-Structured-Data/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2020-05-19">2020-05-19</time>
                  <h4 class="title white no-margin">Bigtable: A Distributed Storage System for Structured Data</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://blog.shunzi.tech/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                <div class="clear"></div>
<script>
jQuery(document).ready(function($){
    $('.vemoji-btn').text('ğŸ˜€');
    $("#comments").on('click', 'span.vat',function(){
        $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
        $('textarea#veditor').focus();
    })
    if(window.location.hash){
        var checkExist = setInterval(function() {
            if ($(window.location.hash).length) {
                $('html, body').animate({scrollTop: $(window.location.hash).offset().top-200}, 600);
                clearInterval(checkExist);
            }
        }, 100);
    }
})
</script>

              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://blog.shunzi.tech/post/Dostoevsky/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20210112173749.png)');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2021-01-12">2021-01-12</time>
                      <h4 class="title usmall">
                        <a href="https://blog.shunzi.tech/post/Dostoevsky/">Dostoevsky: Better Space-Time Trade-Offs for LSM-Tree Based Key-Value Stores via Adaptive Removal of Superfluous Merging</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://blog.shunzi.tech/post/CRaft/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20200614213040.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-12-16">2020-12-16</time>
                      <h4 class="title usmall">
                        <a href="https://blog.shunzi.tech/post/CRaft/">CRaft: An Erasure-coding-supported Version of Raft for Reducing Storage Cost and Network Cost</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://blog.shunzi.tech/post/Alluxio/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://raw.githubusercontent.com/zjs1224522500/PicGoImages/master//img/blog/20201210191906.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-12-10">2020-12-10</time>
                      <h4 class="title usmall">
                        <a href="https://blog.shunzi.tech/post/Alluxio/">Alluxio</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://blog.shunzi.tech/tag/l8sKsLUAi/" class="ctag ctag-0 ctag-l8sKsLUAi" aria-label="">KVS</a>
                    
                      <a href="https://blog.shunzi.tech/tag/5uQUdLlSC/" class="ctag ctag-1 ctag-5uQUdLlSC" aria-label="">Paper</a>
                    
                      <a href="https://blog.shunzi.tech/tag/3zCwFWPHxH/" class="ctag ctag-2 ctag-3zCwFWPHxH" aria-label="">å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/geK0jEW-T/" class="ctag ctag-3 ctag-geK0jEW-T" aria-label="">åˆ†å¸ƒå¼</a>
                    
                      <a href="https://blog.shunzi.tech/tag/9msH-lUaA/" class="ctag ctag-4 ctag-9msH-lUaA" aria-label="">ç¼“å­˜</a>
                    
                      <a href="https://blog.shunzi.tech/tag/_jfuTNqah/" class="ctag ctag-5 ctag-_jfuTNqah" aria-label="">LSM</a>
                    
                      <a href="https://blog.shunzi.tech/tag/i2b42Y2j6/" class="ctag ctag-6 ctag-i2b42Y2j6" aria-label="">Ceph</a>
                    
                      <a href="https://blog.shunzi.tech/tag/la-n8a0mo/" class="ctag ctag-7 ctag-la-n8a0mo" aria-label="">è¯»ä¹¦ç¬”è®°</a>
                    
                      <a href="https://blog.shunzi.tech/tag/os/" class="ctag ctag-8 ctag-os" aria-label="">OS</a>
                    
                      <a href="https://blog.shunzi.tech/tag/oBVOD8v4ou/" class="ctag ctag-9 ctag-oBVOD8v4ou" aria-label="">ä¸€è‡´æ€§</a>
                    
                      <a href="https://blog.shunzi.tech/tag/gqgftpk_y/" class="ctag ctag-10 ctag-gqgftpk_y" aria-label="">AI</a>
                    
                      <a href="https://blog.shunzi.tech/tag/shu-ju-ku/" class="ctag ctag-11 ctag-shu-ju-ku" aria-label="">æ•°æ®åº“</a>
                    
                      <a href="https://blog.shunzi.tech/tag/n2w6bz87h/" class="ctag ctag-12 ctag-n2w6bz87h" aria-label="">ç¼–ç¨‹è¯­è¨€</a>
                    
                      <a href="https://blog.shunzi.tech/tag/ZnIN9Ge-w/" class="ctag ctag-13 ctag-ZnIN9Ge-w" aria-label="">å¯¹è±¡å­˜å‚¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/4zx4ysLGro/" class="ctag ctag-14 ctag-4zx4ysLGro" aria-label="">äº‘è®¡ç®—</a>
                    
                      <a href="https://blog.shunzi.tech/tag/NgjQJdkc6/" class="ctag ctag-15 ctag-NgjQJdkc6" aria-label="">é¡¹ç›®</a>
                    
                      <a href="https://blog.shunzi.tech/tag/5h7k39FKw/" class="ctag ctag-16 ctag-5h7k39FKw" aria-label="">Cè¯­è¨€</a>
                    
                      <a href="https://blog.shunzi.tech/tag/c0aMcnBDAh/" class="ctag ctag-17 ctag-c0aMcnBDAh" aria-label="">C++</a>
                    
                      <a href="https://blog.shunzi.tech/tag/NF-h45xcE/" class="ctag ctag-18 ctag-NF-h45xcE" aria-label="">iscsi</a>
                    
                      <a href="https://blog.shunzi.tech/tag/Y_nsOD1At/" class="ctag ctag-19 ctag-Y_nsOD1At" aria-label="">SSD</a>
                    
                      <a href="https://blog.shunzi.tech/tag/E2d1yYZcV8/" class="ctag ctag-20 ctag-E2d1yYZcV8" aria-label="">è™šæ‹ŸåŒ–</a>
                    
                      <a href="https://blog.shunzi.tech/tag/PhD/" class="ctag ctag-21 ctag-PhD" aria-label="">Ph.D</a>
                    
                      <a href="https://blog.shunzi.tech/tag/ZqEqvRTvl/" class="ctag ctag-22 ctag-ZqEqvRTvl" aria-label="">ç½‘ç»œ</a>
                    
                      <a href="https://blog.shunzi.tech/tag/PuY19cs53/" class="ctag ctag-23 ctag-PuY19cs53" aria-label="">ä»¿çœŸ</a>
                    
                      <a href="https://blog.shunzi.tech/tag/rIIc9E-ZvN/" class="ctag ctag-24 ctag-rIIc9E-ZvN" aria-label="">ç³»ç»Ÿç»“æ„</a>
                    
                      <a href="https://blog.shunzi.tech/tag/fu-wu-qi/" class="ctag ctag-25 ctag-fu-wu-qi" aria-label="">æœåŠ¡å™¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/X-lnqf1Ex/" class="ctag ctag-26 ctag-X-lnqf1Ex" aria-label="">å®¹å™¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/hbaTDSglx-/" class="ctag ctag-27 ctag-hbaTDSglx-" aria-label="">å·¥å…·</a>
                    
                      <a href="https://blog.shunzi.tech/tag/EO3XpMf_y/" class="ctag ctag-28 ctag-EO3XpMf_y" aria-label="">Linux</a>
                    
                      <a href="https://blog.shunzi.tech/tag/diary/" class="ctag ctag-29 ctag-diary" aria-label="">Diary</a>
                    
                      <a href="https://blog.shunzi.tech/tag/DyzFtOe6x/" class="ctag ctag-30 ctag-DyzFtOe6x" aria-label="">è®¡ç®—æœºåŸºç¡€</a>
                    
                      <a href="https://blog.shunzi.tech/tag/oqE3oKihb/" class="ctag ctag-31 ctag-oqE3oKihb" aria-label="">OpenStack</a>
                    
                      <a href="https://blog.shunzi.tech/tag/p_z7gKe6R/" class="ctag ctag-32 ctag-p_z7gKe6R" aria-label="">ä¸­é—´ä»¶</a>
                    
                      <a href="https://blog.shunzi.tech/tag/Test/" class="ctag ctag-33 ctag-Test" aria-label="">æµ‹è¯•</a>
                    
                      <a href="https://blog.shunzi.tech/tag/Product-Standard/" class="ctag ctag-34 ctag-Product-Standard" aria-label="">Product Standard</a>
                    
                      <a href="https://blog.shunzi.tech/tag/spring/" class="ctag ctag-35 ctag-spring" aria-label="">Spring</a>
                    
                      <a href="https://blog.shunzi.tech/tag/she-ji-mo-shi/" class="ctag ctag-36 ctag-she-ji-mo-shi" aria-label="">è®¾è®¡æ¨¡å¼</a>
                    
                      <a href="https://blog.shunzi.tech/tag/mian-jing/" class="ctag ctag-37 ctag-mian-jing" aria-label="">é¢ç»</a>
                    
                      <a href="https://blog.shunzi.tech/tag/suan-fa/" class="ctag ctag-38 ctag-suan-fa" aria-label="">ç®—æ³•</a>
                    
                      <a href="https://blog.shunzi.tech/tag/redis/" class="ctag ctag-39 ctag-redis" aria-label="">Redis</a>
                    
                      <a href="https://blog.shunzi.tech/tag/javaweb/" class="ctag ctag-40 ctag-javaweb" aria-label="">JavaWeb</a>
                    
                      <a href="https://blog.shunzi.tech/tag/KyMCZj2Wl/" class="ctag ctag-41 ctag-KyMCZj2Wl" aria-label="">WEBå®¹å™¨</a>
                    
                      <a href="https://blog.shunzi.tech/tag/javase/" class="ctag ctag-42 ctag-javase" aria-label="">JavaSE</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://blog.shunzi.tech/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">Elvis Zhang</a></h4>
                    <p class="founder">The easy way or the right way.</p>
                    <div class="social">
                      
                          
                            <a href="https://github.com/zjs1224522500" class="translate-effect" target="_blank"><i class="fa fa-github"></i></a>
                        
                      
                          
                            <a href="https://twitter.com/1224522500Elvis" class="translate-effect" target="_blank"><i class="fa fa-twitter"></i></a>
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://blog.shunzi.tech"><img src="\media\images\custom-footerLogo.jpg" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2019 å…± 107 ç¯‡æ–‡ç« 
          <br/>
          Theme <a href="https://gridea.dev/" target="_blank">ã€Œbreekã€</a> Powered by <a href="https://gridea.dev/" target="_blank">ã€ŒGrideaã€</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/valine/1.3.10/Valine.Pure.min.js"></script>
<script>
    new Valine({
        el: '#comments',
        appId: 'Pj5H1z0w7hJlLGJpGBh9NrCq-MdYXbMMI' ,
        appKey: 'LdR8vK5EaBfK87esF7tlbsXe',
        pageSize: 30,
        placeholder: 'æ—¢ç„¶æ¥äº†ï¼Œé‚£å°±ç•™ä¸ªç—•è¿¹å§~',
        visitor: true // é˜…è¯»é‡ç»Ÿè®¡
    })
</script>
    

      
    <script src="https://blog.shunzi.tech/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
